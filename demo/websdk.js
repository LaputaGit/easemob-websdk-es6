!function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=36)}([function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(n,a){"object"===s(e)?t.exports=e=a():(r=[],o=a,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(){var t=t||function(t,e){var n=Object.create||function(){function t(){}return function(e){var n;return t.prototype=e,n=new t,t.prototype=null,n}}(),o={},r=o.lib={},i=r.Base=function(){return{extend:function(t){var e=n(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=r.WordArray=i.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:4*t.length},toString:function(t){return(t||c).stringify(this)},concat:function(t){var e=this.words,n=t.words,o=this.sigBytes,r=t.sigBytes;if(this.clamp(),o%4)for(var i=0;i<r;i++){var s=n[i>>>2]>>>24-i%4*8&255;e[o+i>>>2]|=s<<24-(o+i)%4*8}else for(var i=0;i<r;i+=4)e[o+i>>>2]=n[i>>>2];return this.sigBytes+=r,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n,o=[],r=0;r<e;r+=4){var i=function(e){var e=e,n=987654321,o=4294967295;return function(){n=36969*(65535&n)+(n>>16)&o,e=18e3*(65535&e)+(e>>16)&o;var r=(n<<16)+e&o;return r/=4294967296,(r+=.5)*(t.random()>.5?1:-1)}}(4294967296*(n||t.random()));n=987654071*i(),o.push(4294967296*i()|0)}return new s.init(o,e)}}),a=o.enc={},c=a.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,o=[],r=0;r<n;r++){var i=e[r>>>2]>>>24-r%4*8&255;o.push((i>>>4).toString(16)),o.push((15&i).toString(16))}return o.join("")},parse:function(t){for(var e=t.length,n=[],o=0;o<e;o+=2)n[o>>>3]|=parseInt(t.substr(o,2),16)<<24-o%8*4;return new s.init(n,e/2)}},u=a.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,o=[],r=0;r<n;r++){var i=e[r>>>2]>>>24-r%4*8&255;o.push(String.fromCharCode(i))}return o.join("")},parse:function(t){for(var e=t.length,n=[],o=0;o<e;o++)n[o>>>2]|=(255&t.charCodeAt(o))<<24-o%4*8;return new s.init(n,e)}},l=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return u.parse(unescape(encodeURIComponent(t)))}},p=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=l.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,o=n.words,r=n.sigBytes,i=this.blockSize,a=4*i,c=r/a;c=e?t.ceil(c):t.max((0|c)-this._minBufferSize,0);var u=c*i,l=t.min(4*u,r);if(u){for(var p=0;p<u;p+=i)this._doProcessBlock(o,p);var h=o.splice(0,u);n.sigBytes-=l}return new s.init(h,l)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),h=(r.Hasher=p.extend({cfg:i.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new h.HMAC.init(t,n).finalize(e)}}}),o.algo={});return o}(Math);return t})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(2)):(r=[n(0),n(2)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){t.lib.Cipher||function(e){var n=t,o=n.lib,r=o.Base,i=o.WordArray,s=o.BufferedBlockAlgorithm,a=n.enc,c=(a.Utf8,a.Base64),u=n.algo,l=u.EvpKDF,p=o.Cipher=s.extend({cfg:r.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,n){this.cfg=this.cfg.extend(n),this._xformMode=t,this._key=e,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?E:b}return function(e){return{encrypt:function(n,o,r){return t(o).encrypt(e,n,o,r)},decrypt:function(n,o,r){return t(o).decrypt(e,n,o,r)}}}}()}),h=(o.StreamCipher=p.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),n.mode={}),d=o.BlockCipherMode=r.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),f=h.CBC=function(){function t(t,n,o){var r=this._iv;if(r){var i=r;this._iv=e}else var i=this._prevBlock;for(var s=0;s<o;s++)t[n+s]^=i[s]}var n=d.extend();return n.Encryptor=n.extend({processBlock:function(e,n){var o=this._cipher,r=o.blockSize;t.call(this,e,n,r),o.encryptBlock(e,n),this._prevBlock=e.slice(n,n+r)}}),n.Decryptor=n.extend({processBlock:function(e,n){var o=this._cipher,r=o.blockSize,i=e.slice(n,n+r);o.decryptBlock(e,n),t.call(this,e,n,r),this._prevBlock=i}}),n}(),m=n.pad={},y=m.Pkcs7={pad:function(t,e){for(var n=4*e,o=n-t.sigBytes%n,r=o<<24|o<<16|o<<8|o,s=[],a=0;a<o;a+=4)s.push(r);var c=i.create(s,o);t.concat(c)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},_=(o.BlockCipher=p.extend({cfg:p.cfg.extend({mode:f,padding:y}),reset:function(){p.reset.call(this);var t=this.cfg,e=t.iv,n=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var o=n.createEncryptor;else{var o=n.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==o?this._mode.init(this,e&&e.words):(this._mode=o.call(n,this,e&&e.words),this._mode.__creator=o)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var e=this._process(!0)}else{var e=this._process(!0);t.unpad(e)}return e},blockSize:4}),o.CipherParams=r.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}})),g=n.format={},v=g.OpenSSL={stringify:function(t){var e=t.ciphertext,n=t.salt;if(n)var o=i.create([1398893684,1701076831]).concat(n).concat(e);else var o=e;return o.toString(c)},parse:function(t){var e=c.parse(t),n=e.words;if(1398893684==n[0]&&1701076831==n[1]){var o=i.create(n.slice(2,4));n.splice(0,4),e.sigBytes-=16}return _.create({ciphertext:e,salt:o})}},b=o.SerializableCipher=r.extend({cfg:r.extend({format:v}),encrypt:function(t,e,n,o){o=this.cfg.extend(o);var r=t.createEncryptor(n,o),i=r.finalize(e),s=r.cfg;return _.create({ciphertext:i,key:n,iv:s.iv,algorithm:t,mode:s.mode,padding:s.padding,blockSize:t.blockSize,formatter:o.format})},decrypt:function(t,e,n,o){return o=this.cfg.extend(o),e=this._parse(e,o.format),t.createDecryptor(n,o).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),S=n.kdf={},N=S.OpenSSL={execute:function(t,e,n,o){o||(o=i.random(8));var r=l.create({keySize:e+n}).compute(t,o),s=i.create(r.words.slice(e),4*n);return r.sigBytes=4*e,_.create({key:r,iv:s,salt:o})}},E=o.PasswordBasedCipher=b.extend({cfg:b.cfg.extend({kdf:N}),encrypt:function(t,e,n,o){o=this.cfg.extend(o);var r=o.kdf.execute(n,t.keySize,t.ivSize);o.iv=r.iv;var i=b.encrypt.call(this,t,e,r.key,o);return i.mixIn(r),i},decrypt:function(t,e,n,o){o=this.cfg.extend(o),e=this._parse(e,o.format);var r=o.kdf.execute(n,t.keySize,t.ivSize,e.salt);return o.iv=r.iv,b.decrypt.call(this,t,e,r.key,o)}})}()})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(6),n(7)):(r=[n(0),n(6),n(7)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(){var e=t,n=e.lib,o=n.Base,r=n.WordArray,i=e.algo,s=i.MD5,a=i.EvpKDF=o.extend({cfg:o.extend({keySize:4,hasher:s,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var n=this.cfg,o=n.hasher.create(),i=r.create(),s=i.words,a=n.keySize,c=n.iterations;s.length<a;){u&&o.update(u);var u=o.update(t).finalize(e);o.reset();for(var l=1;l<c;l++)u=o.finalize(u),o.reset();i.concat(u)}return i.sigBytes=4*a,i}});e.EvpKDF=function(t,e,n){return a.create(n).compute(t,e)}}(),t.EvpKDF})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c){"object"===s(e)?t.exports=e=c(n(0)):(r=[n(0)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(){function e(t,e,n){for(var o=[],i=0,s=0;s<e;s++)if(s%4){var a=n[t.charCodeAt(s-1)]<<s%4*2,c=n[t.charCodeAt(s)]>>>6-s%4*2;o[i>>>2]|=(a|c)<<24-i%4*8,i++}return r.create(o,i)}var n=t,o=n.lib,r=o.WordArray,i=n.enc;i.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,o=this._map;t.clamp();for(var r=[],i=0;i<n;i+=3)for(var s=e[i>>>2]>>>24-i%4*8&255,a=e[i+1>>>2]>>>24-(i+1)%4*8&255,c=e[i+2>>>2]>>>24-(i+2)%4*8&255,u=s<<16|a<<8|c,l=0;l<4&&i+.75*l<n;l++)r.push(o.charAt(u>>>6*(3-l)&63));var p=o.charAt(64);if(p)for(;r.length%4;)r.push(p);return r.join("")},parse:function(t){var n=t.length,o=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var i=0;i<o.length;i++)r[o.charCodeAt(i)]=i}var s=o.charAt(64);if(s){var a=t.indexOf(s);-1!==a&&(n=a)}return e(t,n,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),t.enc.Base64})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c){"object"===s(e)?t.exports=e=c(n(0)):(r=[n(0)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(e){function n(t,e,n,o,r,i,s){var a=t+(e&n|~e&o)+r+s;return(a<<i|a>>>32-i)+e}function o(t,e,n,o,r,i,s){var a=t+(e&o|n&~o)+r+s;return(a<<i|a>>>32-i)+e}function r(t,e,n,o,r,i,s){var a=t+(e^n^o)+r+s;return(a<<i|a>>>32-i)+e}function i(t,e,n,o,r,i,s){var a=t+(n^(e|~o))+r+s;return(a<<i|a>>>32-i)+e}var s=t,a=s.lib,c=a.WordArray,u=a.Hasher,l=s.algo,p=[];!function(){for(var t=0;t<64;t++)p[t]=4294967296*e.abs(e.sin(t+1))|0}();var h=l.MD5=u.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var s=0;s<16;s++){var a=e+s,c=t[a];t[a]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}var u=this._hash.words,l=t[e+0],h=t[e+1],d=t[e+2],f=t[e+3],m=t[e+4],y=t[e+5],_=t[e+6],g=t[e+7],v=t[e+8],b=t[e+9],S=t[e+10],N=t[e+11],E=t[e+12],T=t[e+13],x=t[e+14],O=t[e+15],I=u[0],C=u[1],R=u[2],A=u[3];I=n(I,C,R,A,l,7,p[0]),A=n(A,I,C,R,h,12,p[1]),R=n(R,A,I,C,d,17,p[2]),C=n(C,R,A,I,f,22,p[3]),I=n(I,C,R,A,m,7,p[4]),A=n(A,I,C,R,y,12,p[5]),R=n(R,A,I,C,_,17,p[6]),C=n(C,R,A,I,g,22,p[7]),I=n(I,C,R,A,v,7,p[8]),A=n(A,I,C,R,b,12,p[9]),R=n(R,A,I,C,S,17,p[10]),C=n(C,R,A,I,N,22,p[11]),I=n(I,C,R,A,E,7,p[12]),A=n(A,I,C,R,T,12,p[13]),R=n(R,A,I,C,x,17,p[14]),C=n(C,R,A,I,O,22,p[15]),I=o(I,C,R,A,h,5,p[16]),A=o(A,I,C,R,_,9,p[17]),R=o(R,A,I,C,N,14,p[18]),C=o(C,R,A,I,l,20,p[19]),I=o(I,C,R,A,y,5,p[20]),A=o(A,I,C,R,S,9,p[21]),R=o(R,A,I,C,O,14,p[22]),C=o(C,R,A,I,m,20,p[23]),I=o(I,C,R,A,b,5,p[24]),A=o(A,I,C,R,x,9,p[25]),R=o(R,A,I,C,f,14,p[26]),C=o(C,R,A,I,v,20,p[27]),I=o(I,C,R,A,T,5,p[28]),A=o(A,I,C,R,d,9,p[29]),R=o(R,A,I,C,g,14,p[30]),C=o(C,R,A,I,E,20,p[31]),I=r(I,C,R,A,y,4,p[32]),A=r(A,I,C,R,v,11,p[33]),R=r(R,A,I,C,N,16,p[34]),C=r(C,R,A,I,x,23,p[35]),I=r(I,C,R,A,h,4,p[36]),A=r(A,I,C,R,m,11,p[37]),R=r(R,A,I,C,g,16,p[38]),C=r(C,R,A,I,S,23,p[39]),I=r(I,C,R,A,T,4,p[40]),A=r(A,I,C,R,l,11,p[41]),R=r(R,A,I,C,f,16,p[42]),C=r(C,R,A,I,_,23,p[43]),I=r(I,C,R,A,b,4,p[44]),A=r(A,I,C,R,E,11,p[45]),R=r(R,A,I,C,O,16,p[46]),C=r(C,R,A,I,d,23,p[47]),I=i(I,C,R,A,l,6,p[48]),A=i(A,I,C,R,g,10,p[49]),R=i(R,A,I,C,x,15,p[50]),C=i(C,R,A,I,y,21,p[51]),I=i(I,C,R,A,E,6,p[52]),A=i(A,I,C,R,f,10,p[53]),R=i(R,A,I,C,S,15,p[54]),C=i(C,R,A,I,h,21,p[55]),I=i(I,C,R,A,v,6,p[56]),A=i(A,I,C,R,O,10,p[57]),R=i(R,A,I,C,_,15,p[58]),C=i(C,R,A,I,T,21,p[59]),I=i(I,C,R,A,m,6,p[60]),A=i(A,I,C,R,N,10,p[61]),R=i(R,A,I,C,d,15,p[62]),C=i(C,R,A,I,b,21,p[63]),u[0]=u[0]+I|0,u[1]=u[1]+C|0,u[2]=u[2]+R|0,u[3]=u[3]+A|0},_doFinalize:function(){var t=this._data,n=t.words,o=8*this._nDataBytes,r=8*t.sigBytes;n[r>>>5]|=128<<24-r%32;var i=e.floor(o/4294967296),s=o;n[15+(r+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[14+(r+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),t.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return a},clone:function(){var t=u.clone.call(this);return t._hash=this._hash.clone(),t}});s.MD5=u._createHelper(h),s.HmacMD5=u._createHmacHelper(h)}(Math),t.MD5})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c){"object"===s(e)?t.exports=e=c(n(0)):(r=[n(0)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(e){var n=t,o=n.lib,r=o.Base,i=o.WordArray,s=n.x64={};s.Word=r.extend({init:function(t,e){this.high=t,this.low=e}}),s.WordArray=r.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:8*t.length},toX32:function(){for(var t=this.words,e=t.length,n=[],o=0;o<e;o++){var r=t[o];n.push(r.high),n.push(r.low)}return i.create(n,this.sigBytes)},clone:function(){for(var t=r.clone.call(this),e=t.words=this.words.slice(0),n=e.length,o=0;o<n;o++)e[o]=e[o].clone();return t}})}(),t})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c){"object"===s(e)?t.exports=e=c(n(0)):(r=[n(0)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(){var e=t,n=e.lib,o=n.WordArray,r=n.Hasher,i=e.algo,s=[],a=i.SHA1=r.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=this._hash.words,o=n[0],r=n[1],i=n[2],a=n[3],c=n[4],u=0;u<80;u++){if(u<16)s[u]=0|t[e+u];else{var l=s[u-3]^s[u-8]^s[u-14]^s[u-16];s[u]=l<<1|l>>>31}var p=(o<<5|o>>>27)+c+s[u];p+=u<20?1518500249+(r&i|~r&a):u<40?1859775393+(r^i^a):u<60?(r&i|r&a|i&a)-1894007588:(r^i^a)-899497514,c=a,a=i,i=r<<30|r>>>2,r=o,o=p}n[0]=n[0]+o|0,n[1]=n[1]+r|0,n[2]=n[2]+i|0,n[3]=n[3]+a|0,n[4]=n[4]+c|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,o=8*t.sigBytes;return e[o>>>5]|=128<<24-o%32,e[14+(o+64>>>9<<4)]=Math.floor(n/4294967296),e[15+(o+64>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=r.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA1=r._createHelper(a),e.HmacSHA1=r._createHmacHelper(a)}(),t.SHA1})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c){"object"===s(e)?t.exports=e=c(n(0)):(r=[n(0)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){!function(){var e=t,n=e.lib,o=n.Base,r=e.enc,i=r.Utf8,s=e.algo;s.HMAC=o.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=i.parse(e));var n=t.blockSize,o=4*n;e.sigBytes>o&&(e=t.finalize(e)),e.clamp();for(var r=this._oKey=e.clone(),s=this._iKey=e.clone(),a=r.words,c=s.words,u=0;u<n;u++)a[u]^=1549556828,c[u]^=909522486;r.sigBytes=s.sigBytes=o,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,n=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(n))}})}()})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c){"object"===s(e)?t.exports=e=c(n(0)):(r=[n(0)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(e){var n=t,o=n.lib,r=o.WordArray,i=o.Hasher,s=n.algo,a=[],c=[];!function(){function t(t){return 4294967296*(t-(0|t))|0}for(var n=2,o=0;o<64;)(function(t){for(var n=e.sqrt(t),o=2;o<=n;o++)if(!(t%o))return!1;return!0})(n)&&(o<8&&(a[o]=t(e.pow(n,.5))),c[o]=t(e.pow(n,1/3)),o++),n++}();var u=[],l=s.SHA256=i.extend({_doReset:function(){this._hash=new r.init(a.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,o=n[0],r=n[1],i=n[2],s=n[3],a=n[4],l=n[5],p=n[6],h=n[7],d=0;d<64;d++){if(d<16)u[d]=0|t[e+d];else{var f=u[d-15],m=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,y=u[d-2],_=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;u[d]=m+u[d-7]+_+u[d-16]}var g=a&l^~a&p,v=o&r^o&i^r&i,b=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),S=(a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25),N=h+S+g+c[d]+u[d],E=b+v;h=p,p=l,l=a,a=s+N|0,s=i,i=r,r=o,o=N+E|0}n[0]=n[0]+o|0,n[1]=n[1]+r|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+l|0,n[6]=n[6]+p|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,o=8*this._nDataBytes,r=8*t.sigBytes;return n[r>>>5]|=128<<24-r%32,n[14+(r+64>>>9<<4)]=e.floor(o/4294967296),n[15+(r+64>>>9<<4)]=o,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});n.SHA256=i._createHelper(l),n.HmacSHA256=i._createHmacHelper(l)}(Math),t.SHA256})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(5)):(r=[n(0),n(5)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(){function e(){return s.create.apply(s,arguments)}var n=t,o=n.lib,r=o.Hasher,i=n.x64,s=i.Word,a=i.WordArray,c=n.algo,u=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],l=[];!function(){for(var t=0;t<80;t++)l[t]=e()}();var p=c.SHA512=r.extend({_doReset:function(){this._hash=new a.init([new s.init(1779033703,4089235720),new s.init(3144134277,2227873595),new s.init(1013904242,4271175723),new s.init(2773480762,1595750129),new s.init(1359893119,2917565137),new s.init(2600822924,725511199),new s.init(528734635,4215389547),new s.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var n=this._hash.words,o=n[0],r=n[1],i=n[2],s=n[3],a=n[4],c=n[5],p=n[6],h=n[7],d=o.high,f=o.low,m=r.high,y=r.low,_=i.high,g=i.low,v=s.high,b=s.low,S=a.high,N=a.low,E=c.high,T=c.low,x=p.high,O=p.low,I=h.high,C=h.low,R=d,A=f,M=m,w=y,B=_,k=g,D=v,j=b,H=S,L=N,F=E,U=T,W=x,q=O,G=I,P=C,J=0;J<80;J++){var z=l[J];if(J<16)var X=z.high=0|t[e+2*J],$=z.low=0|t[e+2*J+1];else{var K=l[J-15],Q=K.high,V=K.low,Y=(Q>>>1|V<<31)^(Q>>>8|V<<24)^Q>>>7,Z=(V>>>1|Q<<31)^(V>>>8|Q<<24)^(V>>>7|Q<<25),tt=l[J-2],et=tt.high,nt=tt.low,ot=(et>>>19|nt<<13)^(et<<3|nt>>>29)^et>>>6,rt=(nt>>>19|et<<13)^(nt<<3|et>>>29)^(nt>>>6|et<<26),it=l[J-7],st=it.high,at=it.low,ct=l[J-16],ut=ct.high,lt=ct.low,$=Z+at,X=Y+st+($>>>0<Z>>>0?1:0),$=$+rt,X=X+ot+($>>>0<rt>>>0?1:0),$=$+lt,X=X+ut+($>>>0<lt>>>0?1:0);z.high=X,z.low=$}var pt=H&F^~H&W,ht=L&U^~L&q,dt=R&M^R&B^M&B,ft=A&w^A&k^w&k,mt=(R>>>28|A<<4)^(R<<30|A>>>2)^(R<<25|A>>>7),yt=(A>>>28|R<<4)^(A<<30|R>>>2)^(A<<25|R>>>7),_t=(H>>>14|L<<18)^(H>>>18|L<<14)^(H<<23|L>>>9),gt=(L>>>14|H<<18)^(L>>>18|H<<14)^(L<<23|H>>>9),vt=u[J],bt=vt.high,St=vt.low,Nt=P+gt,Et=G+_t+(Nt>>>0<P>>>0?1:0),Nt=Nt+ht,Et=Et+pt+(Nt>>>0<ht>>>0?1:0),Nt=Nt+St,Et=Et+bt+(Nt>>>0<St>>>0?1:0),Nt=Nt+$,Et=Et+X+(Nt>>>0<$>>>0?1:0),Tt=yt+ft,xt=mt+dt+(Tt>>>0<yt>>>0?1:0);G=W,P=q,W=F,q=U,F=H,U=L,L=j+Nt|0,H=D+Et+(L>>>0<j>>>0?1:0)|0,D=B,j=k,B=M,k=w,M=R,w=A,A=Nt+Tt|0,R=Et+xt+(A>>>0<Nt>>>0?1:0)|0}f=o.low=f+A,o.high=d+R+(f>>>0<A>>>0?1:0),y=r.low=y+w,r.high=m+M+(y>>>0<w>>>0?1:0),g=i.low=g+k,i.high=_+B+(g>>>0<k>>>0?1:0),b=s.low=b+j,s.high=v+D+(b>>>0<j>>>0?1:0),N=a.low=N+L,a.high=S+H+(N>>>0<L>>>0?1:0),T=c.low=T+U,c.high=E+F+(T>>>0<U>>>0?1:0),O=p.low=O+q,p.high=x+W+(O>>>0<q>>>0?1:0),C=h.low=C+P,h.high=I+G+(C>>>0<P>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,o=8*t.sigBytes;return e[o>>>5]|=128<<24-o%32,e[30+(o+128>>>10<<5)]=Math.floor(n/4294967296),e[31+(o+128>>>10<<5)]=n,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=r.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32});n.SHA512=r._createHelper(p),n.HmacSHA512=r._createHmacHelper(p)}(),t.SHA512})},function(t,e,n){"use strict";!function(){e.code={WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR:0,WEBIM_CONNCTION_OPEN_ERROR:1,WEBIM_CONNCTION_AUTH_ERROR:2,WEBIM_CONNCTION_OPEN_USERGRID_ERROR:3,WEBIM_CONNCTION_ATTACH_ERROR:4,WEBIM_CONNCTION_ATTACH_USERGRID_ERROR:5,WEBIM_CONNCTION_REOPEN_ERROR:6,WEBIM_CONNCTION_SERVER_CLOSE_ERROR:7,WEBIM_CONNCTION_SERVER_ERROR:8,WEBIM_CONNCTION_IQ_ERROR:9,WEBIM_CONNCTION_PING_ERROR:10,WEBIM_CONNCTION_NOTIFYVERSION_ERROR:11,WEBIM_CONNCTION_GETROSTER_ERROR:12,WEBIM_CONNCTION_CROSSDOMAIN_ERROR:13,WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES:14,WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR:15,WEBIM_CONNCTION_DISCONNECTED:16,WEBIM_CONNCTION_AJAX_ERROR:17,WEBIM_CONNCTION_JOINROOM_ERROR:18,WEBIM_CONNCTION_GETROOM_ERROR:19,WEBIM_CONNCTION_GETROOMINFO_ERROR:20,WEBIM_CONNCTION_GETROOMMEMBER_ERROR:21,WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR:22,WEBIM_CONNCTION_LOAD_CHATROOM_ERROR:23,WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR:24,WEBIM_CONNCTION_JOINCHATROOM_ERROR:25,WEBIM_CONNCTION_QUITCHATROOM_ERROR:26,WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR:27,WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR:28,WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR:29,WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR:30,WEBIM_CONNCTION_CALLBACK_INNER_ERROR:31,WEBIM_CONNCTION_CLIENT_OFFLINE:32,WEBIM_CONNCTION_CLIENT_LOGOUT:33,WEBIM_CONNCTION_CLIENT_TOO_MUCH_ERROR:34,WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP:35,WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP:36,WEBIM_CONNECTION_ACCEPT_JOIN_GROUP:37,WEBIM_CONNECTION_DECLINE_JOIN_GROUP:38,WEBIM_CONNECTION_CLOSED:39,WEBIM_UPLOADFILE_BROWSER_ERROR:100,WEBIM_UPLOADFILE_ERROR:101,WEBIM_UPLOADFILE_NO_LOGIN:102,WEBIM_UPLOADFILE_NO_FILE:103,WEBIM_DOWNLOADFILE_ERROR:200,WEBIM_DOWNLOADFILE_NO_LOGIN:201,WEBIM_DOWNLOADFILE_BROWSER_ERROR:202,WEBIM_MESSAGE_REC_TEXT:300,WEBIM_MESSAGE_REC_TEXT_ERROR:301,WEBIM_MESSAGE_REC_EMOTION:302,WEBIM_MESSAGE_REC_PHOTO:303,WEBIM_MESSAGE_REC_AUDIO:304,WEBIM_MESSAGE_REC_AUDIO_FILE:305,WEBIM_MESSAGE_REC_VEDIO:306,WEBIM_MESSAGE_REC_VEDIO_FILE:307,WEBIM_MESSAGE_REC_FILE:308,WEBIM_MESSAGE_SED_TEXT:309,WEBIM_MESSAGE_SED_EMOTION:310,WEBIM_MESSAGE_SED_PHOTO:311,WEBIM_MESSAGE_SED_AUDIO:312,WEBIM_MESSAGE_SED_AUDIO_FILE:313,WEBIM_MESSAGE_SED_VEDIO:314,WEBIM_MESSAGE_SED_VEDIO_FILE:315,WEBIM_MESSAGE_SED_FILE:316,WEBIM_MESSAGE_SED_ERROR:317,STATUS_INIT:400,STATUS_DOLOGIN_USERGRID:401,STATUS_DOLOGIN_IM:402,STATUS_OPENED:403,STATUS_CLOSING:404,STATUS_CLOSED:405,STATUS_ERROR:406}}()},function(t,e,n){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){var t=function(){},r=n(10).code,i=function(){try{return new window.XMLHttpRequest}catch(t){return!1}},s=function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(t){return!1}},a=function(e){e=e||!0;var n=i()||s();if("withCredentials"in n)return n;if(!e)return n;if(void 0===window.XDomainRequest)return n;var o=new XDomainRequest;return o.readyState=0,o.status=100,o.onreadystatechange=t,o.onload=function(){o.readyState=4,o.status=200;var t=new ActiveXObject("Microsoft.XMLDOM");t.async="false",t.loadXML(o.responseText),o.responseXML=t,o.response=o.responseText,o.onreadystatechange()},o.ontimeout=o.onerror=function(){o.readyState=4,o.status=500,o.onreadystatechange()},o},c=function(){if("ActiveXObject"in window)try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(t){return 0}else if(navigator.plugins&&navigator.plugins.length>0)return navigator.plugins["Shockwave Flash"];return 0}(),u=a(),l="undefined"!=typeof FormData,p="undefined"!=typeof Blob,h=u.setRequestHeader||!1,d=u.overrideMimeType||!1,f=h&&l,m=f||c,y=h&&(p||d);Object.keys||(Object.keys=function(){var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(i){if("object"!==(void 0===i?"undefined":o(i))&&("function"!=typeof i||null===i))throw new TypeError("Object.keys called on non-object");var s,a,c=[];for(s in i)t.call(i,s)&&c.push(s);if(e)for(a=0;a<r;a++)t.call(i,n[a])&&c.push(n[a]);return c}}());var _={hasFormData:l,hasBlob:p,emptyfn:t,isCanSetRequestHeader:h,hasOverrideMimeType:d,isCanUploadFileAsync:f,isCanUploadFile:m,isCanDownLoadFile:y,isSupportWss:function(){var t=[/MQQBrowser[\/]5([.]\d+)?\sTBS/];if(!window.WebSocket)return!1;for(var e=window.navigator.userAgent,n=0,o=t.length;n<o;n++)if(t[n].test(e))return!1;return!0}(),getIEVersion:function(){var t,e=navigator.userAgent,n={4:8,5:9,6:10,7:11};return(t=e.match(/MSIE (\d+)/i))&&t[1]?+t[1]:(t=e.match(/Trident\/(\d+)/i),t&&t[1]?n[t[1]]||null:null)}(),stringify:function(t){if("undefined"!=typeof JSON&&JSON.stringify)return JSON.stringify(t);var e="",n=[];return function t(r){var i=!1;"[object Array]"===Object.prototype.toString.call(r)?(n.push("]","["),i=!0):"[object Object]"===Object.prototype.toString.call(r)&&n.push("}","{");for(var s in r)"[object Null]"===Object.prototype.toString.call(r[s])?r[s]="null":"[object Undefined]"===Object.prototype.toString.call(r[s])&&(r[s]="undefined"),r[s]&&"object"===o(r[s])?e+=","+(i?"":'"'+s+'":'+(i?'"':""))+t(r[s]):e+=',"'+(i?"":s+'":"')+r[s]+'"';return""!=e&&(e=e.slice(1)),n.pop()+e+n.pop()}(t)},login:function(e){var e=e||{},n=e.success||t,o=e.error||t,i=e.appKey||"",s=i.split("#");if(2!==s.length)return o({type:r.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var a=s[0],c=s[1],u=u||e.https,l=e.user||"",p=e.pwd||"",h=e.apiUrl,d={grant_type:"password",username:l,password:p,timestamp:+new Date},f=_.stringify(d),e={url:h+"/"+a+"/"+c+"/token",dataType:"json",data:f,success:n,error:o};return _.ajax(e)},getFileUrl:function(t){var e={url:"",filename:"",filetype:"",data:""},n="string"==typeof t?document.getElementById(t):t;if(!_.isCanUploadFileAsync||!n)return e;try{if(window.URL.createObjectURL){var o=n.files;if(o.length>0){var r=o.item(0);e.data=r,e.url=window.URL.createObjectURL(r),e.filename=r.name||""}}else{var r=document.getElementById(t).value;e.url=r;var i=r.lastIndexOf("/"),s=r.lastIndexOf("\\"),a=Math.max(i,s);e.filename=a<0?r:r.substring(a+1)}var c=e.filename.lastIndexOf(".");return-1!=c&&(e.filetype=e.filename.substring(c+1).toLowerCase()),e}catch(t){throw t}},getFileSize:function(t){var e=this.getFileLength(t);if(e>1e7)return!1;var n=Math.round(e/1e3);if(n<1e3)e=n+" KB";else if(n>=1e3){var o=n/1e3;if(o<1e3)e=o.toFixed(1)+" MB";else{var r=o/1e3;e=r.toFixed(1)+" GB"}}return e},getFileLength:function(t){var e=0;if(t)if(t.files)t.files.length>0&&(e=t.files[0].size);else if(t.select&&"ActiveXObject"in window){t.select();var n=new ActiveXObject("Scripting.FileSystemObject"),t=n.GetFile(t.value);e=t.Size}return e},hasFlash:c,trim:function(t){return t="string"==typeof t?t:"",t.trim?t.trim():t.replace(/^\s|\s$/g,"")},parseEmoji:function(t){if(void 0===WebIM.Emoji||void 0===WebIM.Emoji.map)return t;var e=WebIM.Emoji;for(var n in e.map)if(e.map.hasOwnProperty(n))for(;t.indexOf(n)>-1;)t=t.replace(n,'<img class="emoji" src="'+e.path+e.map[n]+'" />');return t},parseLink:function(t){var e=/(https?\:\/\/|www\.)([a-zA-Z0-9-]+(\.[a-zA-Z0-9]+)+)(\:[0-9]{2,4})?\/?((\.[:_0-9a-zA-Z-]+)|[:_0-9a-zA-Z-]*\/?)*\??[:_#@*&%0-9a-zA-Z-\/=]*/gm;return t=t.replace(e,function(t){return"<a href='"+(/^https?/gm.test(t)?t:"//"+t)+"' target='_blank'>"+t+"</a>"})},parseJSON:function(t){if(window.JSON&&window.JSON.parse)return window.JSON.parse(t+"");var e,n=null,o=_.trim(t+"");return o&&!_.trim(o.replace(/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,function(t,o,r,i){return e&&o&&(n=0),0===n?t:(e=r||o,n+=!i-!r,"")}))?Function("return "+o)():Function("Invalid JSON: "+t)()},parseUploadResponse:function(t){return t.indexOf("callback")>-1?t.slice(9,-1):t},parseDownloadResponse:function(t){return t&&t.type&&"application/json"===t.type||0>Object.prototype.toString.call(t).indexOf("Blob")?this.url+"?token=":window.URL.createObjectURL(t)},uploadFile:function(e){var e=e||{};e.onFileUploadProgress=e.onFileUploadProgress||t,e.onFileUploadComplete=e.onFileUploadComplete||t,e.onFileUploadError=e.onFileUploadError||t,e.onFileUploadCanceled=e.onFileUploadCanceled||t;var n=e.accessToken||this.context.accessToken;if(!n)return void e.onFileUploadError({type:r.WEBIM_UPLOADFILE_NO_LOGIN,id:e.id});var o,i,s,a=e.appKey||this.context.appKey||"";if(a&&(s=a.split("#"),o=s[0],i=s[1]),!o&&!i)return void e.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,id:e.id});var c=e.apiUrl,u=c+"/"+o+"/"+i+"/chatfiles";if(!_.isCanUploadFileAsync)return void(_.hasFlash&&"function"==typeof e.flashUpload?e.flashUpload&&e.flashUpload(u,e):e.onFileUploadError({type:r.WEBIM_UPLOADFILE_BROWSER_ERROR,id:e.id}));var l=e.file.data?e.file.data.size:void 0;if(l>10485760)return void e.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,id:e.id});if(l<=0)return void e.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,id:e.id});var p=_.xmlrequest(),h=function(t){e.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,id:e.id,xhr:p})};p.upload&&p.upload.addEventListener("progress",e.onFileUploadProgress,!1),p.addEventListener?(p.addEventListener("abort",e.onFileUploadCanceled,!1),p.addEventListener("load",function(t){try{var n=_.parseJSON(p.responseText);try{e.onFileUploadComplete(n)}catch(t){e.onFileUploadError({type:r.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:t})}}catch(t){e.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,data:p.responseText,id:e.id,xhr:p})}},!1),p.addEventListener("error",h,!1)):p.onreadystatechange&&(p.onreadystatechange=function(){if(4===p.readyState)if(200===ajax.status)try{var t=_.parseJSON(p.responseText);e.onFileUploadComplete(t)}catch(t){e.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,data:p.responseText,id:e.id,xhr:p})}else e.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,data:p.responseText,id:e.id,xhr:p});else p.abort(),e.onFileUploadCanceled()}),p.open("POST",u),p.setRequestHeader("restrict-access","true"),p.setRequestHeader("Accept","*/*"),p.setRequestHeader("Authorization","Bearer "+n);var d=new FormData;d.append("file",e.file.data),window.XDomainRequest&&(p.readyState=2),p.send(d)},download:function(e){e.onFileDownloadComplete=e.onFileDownloadComplete||t,e.onFileDownloadError=e.onFileDownloadError||t;var n=e.accessToken||this.context.accessToken;if(!n)return void e.onFileDownloadError({type:r.WEBIM_DOWNLOADFILE_NO_LOGIN,id:e.id});var o=function(t){e.onFileDownloadError({type:r.WEBIM_DOWNLOADFILE_ERROR,id:e.id,xhr:i})};if(!_.isCanDownLoadFile)return void e.onFileDownloadComplete();var i=_.xmlrequest();"addEventListener"in i?(i.addEventListener("load",function(t){e.onFileDownloadComplete(i.response,i)},!1),i.addEventListener("error",o,!1)):"onreadystatechange"in i&&(i.onreadystatechange=function(){4===i.readyState?200===ajax.status?e.onFileDownloadComplete(i.response,i):e.onFileDownloadError({type:r.WEBIM_DOWNLOADFILE_ERROR,id:e.id,xhr:i}):(i.abort(),e.onFileDownloadError({type:r.WEBIM_DOWNLOADFILE_ERROR,id:e.id,xhr:i}))});var s=e.method||"GET",a=e.responseType||"blob",c=e.mimeType||"text/plain; charset=x-user-defined";i.open(s,e.url),"undefined"!=typeof Blob?i.responseType=a:i.overrideMimeType(c);var u={"X-Requested-With":"XMLHttpRequest",Accept:"application/octet-stream","share-secret":e.secret,Authorization:"Bearer "+n},l=e.headers||{};for(var p in l)u[p]=l[p];for(var p in u)u[p]&&i.setRequestHeader(p,u[p]);window.XDomainRequest&&(i.readyState=2),i.send(null)},parseTextMessage:function(t,e){if("string"==typeof t){if("[object Object]"!==Object.prototype.toString.call(e))return{isemoji:!1,body:[{type:"txt",data:t}]};var n=t,o=[],r=/\[[^[\]]{2,3}\]/gm,i=n.match(r);if(!i||i.length<1)return{isemoji:!1,body:[{type:"txt",data:t}]};for(var s=!1,a=0;a<i.length;a++){var c=n.substring(0,n.indexOf(i[a])),u=WebIM.Emoji.map[i[a]];if(c&&o.push({type:"txt",data:c}),u){var l=WebIM.Emoji.map?WebIM.Emoji.path+u:null;l?(s=!0,o.push({type:"emoji",data:l})):o.push({type:"txt",data:i[a]});var p=n.indexOf(i[a])+i[a].length;n=n.substring(p)}else o.push({type:"txt",data:i[a]})}return n&&o.push({type:"txt",data:n}),s?{isemoji:s,body:o}:{isemoji:!1,body:[{type:"txt",data:t}]}}},parseUri:function(){var t=/([^\?|&])\w+=([^&]+)/g,e={};if(window.location.search){var n=window.location.search.match(t);for(var o in n){var r=n[o],i=r.indexOf("="),s=r.substr(0,i),a=r.substr(i+1);e[s]=a}}return e},parseHrefHash:function(){var t=/([^\#|&])\w+=([^&]+)/g,e={};if(window.location.hash){var n=window.location.hash.match(t);for(var o in n){var r=n[o],i=r.indexOf("="),s=r.substr(0,i),a=r.substr(i+1);e[s]=a}}return e},xmlrequest:a,getXmlFirstChild:function(t,e){var n=t.getElementsByTagName(e);return 0==n.length?null:n[0]},ajax:function(e){var n=e.dataType||"text",o=e.success||t,i=e.error||t,s=_.xmlrequest();s.onreadystatechange=function(){if(4===s.readyState){if(200===(s.status||0)){try{switch(n){case"text":return void o(s.responseText);case"json":var t=_.parseJSON(s.responseText);return void o(t,s);case"xml":return void(s.responseXML&&s.responseXML.documentElement?o(s.responseXML.documentElement,s):i({type:r.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText}))}o(s.response||s.responseText,s)}catch(t){i({type:r.WEBIM_CONNCTION_AJAX_ERROR,data:t})}return}return void i({type:r.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText})}0===s.readyState&&i({type:r.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText})},e.responseType&&s.responseType&&(s.responseType=e.responseType),e.mimeType&&_.hasOverrideMimeType&&s.overrideMimeType(e.mimeType);var a=e.type||"POST",c=e.data||null,u="";if("get"===a.toLowerCase()&&c){for(var l in c)c.hasOwnProperty(l)&&(u+=l+"="+c[l]+"&");u=u?u.slice(0,-1):u,e.url+=(e.url.indexOf("?")>0?"&":"?")+(u?u+"&":u)+"_v="+(new Date).getTime(),c=null,u=null}if(s.open(a,e.url,_.isCanSetRequestHeader),_.isCanSetRequestHeader){var p=e.headers||{};for(var h in p)p.hasOwnProperty(h)&&s.setRequestHeader(h,p[h])}return window.XDomainRequest&&(s.readyState=2),s.send(c),s},ts:function(){var t=new Date,e=t.getHours(),n=t.getMinutes(),o=t.getSeconds(),r=t.getMilliseconds();return(e<10?"0"+e:e)+":"+(n<10?"0"+n:n)+":"+(o<10?"0"+o:o)+":"+r+" "},getObjectKey:function(t,e){for(var n in t)if(t[n]==e)return n;return""},sprintf:function(){var t,e,n=arguments,o=n[0]||"";for(t=1,e=n.length;t<e;t++)o=o.replace(/%s/,n[t]);return o},setCookie:function(t,e,n){var o=t+"="+encodeURIComponent(e);"number"==typeof n&&(o+="; max-age: "+60*n*60*24),document.cookie=o},getCookie:function(){var t={},e=document.cookie;if(""===e)return t;for(var n=e.split("; "),o=0;o<n.length;o++){var r=n[o],i=r.indexOf("="),s=r.substring(0,i),a=r.substring(i+1);a=decodeURIComponent(a),t[s]=a}return t}};e.utils=_}()},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(5),n(13),n(14),n(3),n(4),n(6),n(8),n(15),n(9),n(16),n(17),n(18),n(7),n(19),n(2),n(1),n(20),n(21),n(22),n(23),n(24),n(25),n(26),n(27),n(28),n(29),n(30),n(31),n(32),n(33),n(34),n(35)):(r=[n(0),n(5),n(13),n(14),n(3),n(4),n(6),n(8),n(15),n(9),n(16),n(17),n(18),n(7),n(19),n(2),n(1),n(20),n(21),n(22),n(23),n(24),n(25),n(26),n(27),n(28),n(29),n(30),n(31),n(32),n(33),n(34),n(35)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return t})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c){"object"===s(e)?t.exports=e=c(n(0)):(r=[n(0)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(){if("function"==typeof ArrayBuffer){var e=t,n=e.lib,o=n.WordArray,r=o.init;(o.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var e=t.byteLength,n=[],o=0;o<e;o++)n[o>>>2]|=t[o]<<24-o%4*8;r.call(this,n,e)}else r.apply(this,arguments)}).prototype=o}}(),t.lib.WordArray})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c){"object"===s(e)?t.exports=e=c(n(0)):(r=[n(0)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(){function e(t){return t<<8&4278255360|t>>>8&16711935}var n=t,o=n.lib,r=o.WordArray,i=n.enc;i.Utf16=i.Utf16BE={stringify:function(t){for(var e=t.words,n=t.sigBytes,o=[],r=0;r<n;r+=2){var i=e[r>>>2]>>>16-r%4*8&65535;o.push(String.fromCharCode(i))}return o.join("")},parse:function(t){for(var e=t.length,n=[],o=0;o<e;o++)n[o>>>1]|=t.charCodeAt(o)<<16-o%2*16;return r.create(n,2*e)}};i.Utf16LE={stringify:function(t){for(var n=t.words,o=t.sigBytes,r=[],i=0;i<o;i+=2){var s=e(n[i>>>2]>>>16-i%4*8&65535);r.push(String.fromCharCode(s))}return r.join("")},parse:function(t){for(var n=t.length,o=[],i=0;i<n;i++)o[i>>>1]|=e(t.charCodeAt(i)<<16-i%2*16);return r.create(o,2*n)}}}(),t.enc.Utf16})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(8)):(r=[n(0),n(8)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(){var e=t,n=e.lib,o=n.WordArray,r=e.algo,i=r.SHA256,s=r.SHA224=i.extend({_doReset:function(){this._hash=new o.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var t=i._doFinalize.call(this);return t.sigBytes-=4,t}});e.SHA224=i._createHelper(s),e.HmacSHA224=i._createHmacHelper(s)}(),t.SHA224})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(5),n(9)):(r=[n(0),n(5),n(9)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(){var e=t,n=e.x64,o=n.Word,r=n.WordArray,i=e.algo,s=i.SHA512,a=i.SHA384=s.extend({_doReset:function(){this._hash=new r.init([new o.init(3418070365,3238371032),new o.init(1654270250,914150663),new o.init(2438529370,812702999),new o.init(355462360,4144912697),new o.init(1731405415,4290775857),new o.init(2394180231,1750603025),new o.init(3675008525,1694076839),new o.init(1203062813,3204075428)])},_doFinalize:function(){var t=s._doFinalize.call(this);return t.sigBytes-=16,t}});e.SHA384=s._createHelper(a),e.HmacSHA384=s._createHmacHelper(a)}(),t.SHA384})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(5)):(r=[n(0),n(5)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(e){var n=t,o=n.lib,r=o.WordArray,i=o.Hasher,s=n.x64,a=s.Word,c=n.algo,u=[],l=[],p=[];!function(){for(var t=1,e=0,n=0;n<24;n++){u[t+5*e]=(n+1)*(n+2)/2%64;var o=e%5,r=(2*t+3*e)%5;t=o,e=r}for(var t=0;t<5;t++)for(var e=0;e<5;e++)l[t+5*e]=e+(2*t+3*e)%5*5;for(var i=1,s=0;s<24;s++){for(var c=0,h=0,d=0;d<7;d++){if(1&i){var f=(1<<d)-1;f<32?h^=1<<f:c^=1<<f-32}128&i?i=i<<1^113:i<<=1}p[s]=a.create(c,h)}}();var h=[];!function(){for(var t=0;t<25;t++)h[t]=a.create()}();var d=c.SHA3=i.extend({cfg:i.cfg.extend({outputLength:512}),_doReset:function(){for(var t=this._state=[],e=0;e<25;e++)t[e]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(t,e){for(var n=this._state,o=this.blockSize/2,r=0;r<o;r++){var i=t[e+2*r],s=t[e+2*r+1];i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8);var a=n[r];a.high^=s,a.low^=i}for(var c=0;c<24;c++){for(var d=0;d<5;d++){for(var f=0,m=0,y=0;y<5;y++){var a=n[d+5*y];f^=a.high,m^=a.low}var _=h[d];_.high=f,_.low=m}for(var d=0;d<5;d++)for(var g=h[(d+4)%5],v=h[(d+1)%5],b=v.high,S=v.low,f=g.high^(b<<1|S>>>31),m=g.low^(S<<1|b>>>31),y=0;y<5;y++){var a=n[d+5*y];a.high^=f,a.low^=m}for(var N=1;N<25;N++){var a=n[N],E=a.high,T=a.low,x=u[N];if(x<32)var f=E<<x|T>>>32-x,m=T<<x|E>>>32-x;else var f=T<<x-32|E>>>64-x,m=E<<x-32|T>>>64-x;var O=h[l[N]];O.high=f,O.low=m}var I=h[0],C=n[0];I.high=C.high,I.low=C.low;for(var d=0;d<5;d++)for(var y=0;y<5;y++){var N=d+5*y,a=n[N],R=h[N],A=h[(d+1)%5+5*y],M=h[(d+2)%5+5*y];a.high=R.high^~A.high&M.high,a.low=R.low^~A.low&M.low}var a=n[0],w=p[c];a.high^=w.high,a.low^=w.low}},_doFinalize:function(){var t=this._data,n=t.words,o=(this._nDataBytes,8*t.sigBytes),i=32*this.blockSize;n[o>>>5]|=1<<24-o%32,n[(e.ceil((o+1)/i)*i>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var s=this._state,a=this.cfg.outputLength/8,c=a/8,u=[],l=0;l<c;l++){var p=s[l],h=p.high,d=p.low;h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),u.push(d),u.push(h)}return new r.init(u,a)},clone:function(){for(var t=i.clone.call(this),e=t._state=this._state.slice(0),n=0;n<25;n++)e[n]=e[n].clone();return t}});n.SHA3=i._createHelper(d),n.HmacSHA3=i._createHmacHelper(d)}(Math),t.SHA3})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c){"object"===s(e)?t.exports=e=c(n(0)):(r=[n(0)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){/** @preserve
 (c) 2012 by Cédric Mesnil. All rights reserved.
 	Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
 	    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
     - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
 	THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
return function(e){function n(t,e,n){return t^e^n}function o(t,e,n){return t&e|~t&n}function r(t,e,n){return(t|~e)^n}function i(t,e,n){return t&n|e&~n}function s(t,e,n){return t^(e|~n)}function a(t,e){return t<<e|t>>>32-e}var c=t,u=c.lib,l=u.WordArray,p=u.Hasher,h=c.algo,d=l.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),f=l.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),m=l.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),y=l.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),_=l.create([0,1518500249,1859775393,2400959708,2840853838]),g=l.create([1352829926,1548603684,1836072691,2053994217,0]),v=h.RIPEMD160=p.extend({_doReset:function(){this._hash=l.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var c=0;c<16;c++){var u=e+c,l=t[u];t[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var p,h,v,b,S,N,E,T,x,O,I=this._hash.words,C=_.words,R=g.words,A=d.words,M=f.words,w=m.words,B=y.words;N=p=I[0],E=h=I[1],T=v=I[2],x=b=I[3],O=S=I[4];for(var k,c=0;c<80;c+=1)k=p+t[e+A[c]]|0,k+=c<16?n(h,v,b)+C[0]:c<32?o(h,v,b)+C[1]:c<48?r(h,v,b)+C[2]:c<64?i(h,v,b)+C[3]:s(h,v,b)+C[4],k|=0,k=a(k,w[c]),k=k+S|0,p=S,S=b,b=a(v,10),v=h,h=k,k=N+t[e+M[c]]|0,k+=c<16?s(E,T,x)+R[0]:c<32?i(E,T,x)+R[1]:c<48?r(E,T,x)+R[2]:c<64?o(E,T,x)+R[3]:n(E,T,x)+R[4],k|=0,k=a(k,B[c]),k=k+O|0,N=O,O=x,x=a(T,10),T=E,E=k;k=I[1]+v+x|0,I[1]=I[2]+b+O|0,I[2]=I[3]+S+N|0,I[3]=I[4]+p+E|0,I[4]=I[0]+h+T|0,I[0]=k},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,o=8*t.sigBytes;e[o>>>5]|=128<<24-o%32,e[14+(o+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(e.length+1),this._process();for(var r=this._hash,i=r.words,s=0;s<5;s++){var a=i[s];i[s]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return r},clone:function(){var t=p.clone.call(this);return t._hash=this._hash.clone(),t}});c.RIPEMD160=p._createHelper(v),c.HmacRIPEMD160=p._createHmacHelper(v)}(Math),t.RIPEMD160})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(6),n(7)):(r=[n(0),n(6),n(7)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(){var e=t,n=e.lib,o=n.Base,r=n.WordArray,i=e.algo,s=i.SHA1,a=i.HMAC,c=i.PBKDF2=o.extend({cfg:o.extend({keySize:4,hasher:s,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var n=this.cfg,o=a.create(n.hasher,t),i=r.create(),s=r.create([1]),c=i.words,u=s.words,l=n.keySize,p=n.iterations;c.length<l;){var h=o.update(e).finalize(s);o.reset();for(var d=h.words,f=d.length,m=h,y=1;y<p;y++){m=o.finalize(m),o.reset();for(var _=m.words,g=0;g<f;g++)d[g]^=_[g]}i.concat(h),u[0]++}return i.sigBytes=4*l,i}});e.PBKDF2=function(t,e,n){return c.create(n).compute(t,e)}}(),t.PBKDF2})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(1)):(r=[n(0),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return t.mode.CFB=function(){function e(t,e,n,o){var r=this._iv;if(r){var i=r.slice(0);this._iv=void 0}else var i=this._prevBlock;o.encryptBlock(i,0);for(var s=0;s<n;s++)t[e+s]^=i[s]}var n=t.lib.BlockCipherMode.extend();return n.Encryptor=n.extend({processBlock:function(t,n){var o=this._cipher,r=o.blockSize;e.call(this,t,n,r,o),this._prevBlock=t.slice(n,n+r)}}),n.Decryptor=n.extend({processBlock:function(t,n){var o=this._cipher,r=o.blockSize,i=t.slice(n,n+r);e.call(this,t,n,r,o),this._prevBlock=i}}),n}(),t.mode.CFB})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(1)):(r=[n(0),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return t.mode.CTR=function(){var e=t.lib.BlockCipherMode.extend(),n=e.Encryptor=e.extend({processBlock:function(t,e){var n=this._cipher,o=n.blockSize,r=this._iv,i=this._counter;r&&(i=this._counter=r.slice(0),this._iv=void 0);var s=i.slice(0);n.encryptBlock(s,0),i[o-1]=i[o-1]+1|0;for(var a=0;a<o;a++)t[e+a]^=s[a]}});return e.Decryptor=n,e}(),t.mode.CTR})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(1)):(r=[n(0),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){/** @preserve
  * Counter block mode compatible with  Dr Brian Gladman fileenc.c
  * derived from CryptoJS.mode.CTR
  * Jan Hruby jhruby.web@gmail.com
  */
return t.mode.CTRGladman=function(){function e(t){if(255==(t>>24&255)){var e=t>>16&255,n=t>>8&255,o=255&t;255===e?(e=0,255===n?(n=0,255===o?o=0:++o):++n):++e,t=0,t+=e<<16,t+=n<<8,t+=o}else t+=1<<24;return t}function n(t){return 0===(t[0]=e(t[0]))&&(t[1]=e(t[1])),t}var o=t.lib.BlockCipherMode.extend(),r=o.Encryptor=o.extend({processBlock:function(t,e){var o=this._cipher,r=o.blockSize,i=this._iv,s=this._counter;i&&(s=this._counter=i.slice(0),this._iv=void 0),n(s);var a=s.slice(0);o.encryptBlock(a,0);for(var c=0;c<r;c++)t[e+c]^=a[c]}});return o.Decryptor=r,o}(),t.mode.CTRGladman})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(1)):(r=[n(0),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return t.mode.OFB=function(){var e=t.lib.BlockCipherMode.extend(),n=e.Encryptor=e.extend({processBlock:function(t,e){var n=this._cipher,o=n.blockSize,r=this._iv,i=this._keystream;r&&(i=this._keystream=r.slice(0),this._iv=void 0),n.encryptBlock(i,0);for(var s=0;s<o;s++)t[e+s]^=i[s]}});return e.Decryptor=n,e}(),t.mode.OFB})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(1)):(r=[n(0),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return t.mode.ECB=function(){var e=t.lib.BlockCipherMode.extend();return e.Encryptor=e.extend({processBlock:function(t,e){this._cipher.encryptBlock(t,e)}}),e.Decryptor=e.extend({processBlock:function(t,e){this._cipher.decryptBlock(t,e)}}),e}(),t.mode.ECB})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(1)):(r=[n(0),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return t.pad.AnsiX923={pad:function(t,e){var n=t.sigBytes,o=4*e,r=o-n%o,i=n+r-1;t.clamp(),t.words[i>>>2]|=r<<24-i%4*8,t.sigBytes+=r},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},t.pad.Ansix923})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(1)):(r=[n(0),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return t.pad.Iso10126={pad:function(e,n){var o=4*n,r=o-e.sigBytes%o;e.concat(t.lib.WordArray.random(r-1)).concat(t.lib.WordArray.create([r<<24],1))},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},t.pad.Iso10126})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(1)):(r=[n(0),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return t.pad.Iso97971={pad:function(e,n){e.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(e,n)},unpad:function(e){t.pad.ZeroPadding.unpad(e),e.sigBytes--}},t.pad.Iso97971})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(1)):(r=[n(0),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return t.pad.ZeroPadding={pad:function(t,e){var n=4*e;t.clamp(),t.sigBytes+=n-(t.sigBytes%n||n)},unpad:function(t){for(var e=t.words,n=t.sigBytes-1;!(e[n>>>2]>>>24-n%4*8&255);)n--;t.sigBytes=n+1}},t.pad.ZeroPadding})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(1)):(r=[n(0),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(1)):(r=[n(0),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(e){var n=t,o=n.lib,r=o.CipherParams,i=n.enc,s=i.Hex,a=n.format;a.Hex={stringify:function(t){return t.ciphertext.toString(s)},parse:function(t){var e=s.parse(t);return r.create({ciphertext:e})}}}(),t.format.Hex})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(3),n(4),n(2),n(1)):(r=[n(0),n(3),n(4),n(2),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(){var e=t,n=e.lib,o=n.BlockCipher,r=e.algo,i=[],s=[],a=[],c=[],u=[],l=[],p=[],h=[],d=[],f=[];!function(){for(var t=[],e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;for(var n=0,o=0,e=0;e<256;e++){var r=o^o<<1^o<<2^o<<3^o<<4;r=r>>>8^255&r^99,i[n]=r,s[r]=n;var m=t[n],y=t[m],_=t[y],g=257*t[r]^16843008*r;a[n]=g<<24|g>>>8,c[n]=g<<16|g>>>16,u[n]=g<<8|g>>>24,l[n]=g;var g=16843009*_^65537*y^257*m^16843008*n;p[r]=g<<24|g>>>8,h[r]=g<<16|g>>>16,d[r]=g<<8|g>>>24,f[r]=g,n?(n=m^t[t[t[_^m]]],o^=t[t[o]]):n=o=1}}();var m=[0,1,2,4,8,16,32,64,128,27,54],y=r.AES=o.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,e=t.words,n=t.sigBytes/4,o=this._nRounds=n+6,r=4*(o+1),s=this._keySchedule=[],a=0;a<r;a++)if(a<n)s[a]=e[a];else{var c=s[a-1];a%n?n>6&&a%n==4&&(c=i[c>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c]):(c=c<<8|c>>>24,c=i[c>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c],c^=m[a/n|0]<<24),s[a]=s[a-n]^c}for(var u=this._invKeySchedule=[],l=0;l<r;l++){var a=r-l;if(l%4)var c=s[a];else var c=s[a-4];u[l]=l<4||a<=4?c:p[i[c>>>24]]^h[i[c>>>16&255]]^d[i[c>>>8&255]]^f[i[255&c]]}}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,a,c,u,l,i)},decryptBlock:function(t,e){var n=t[e+1];t[e+1]=t[e+3],t[e+3]=n,this._doCryptBlock(t,e,this._invKeySchedule,p,h,d,f,s);var n=t[e+1];t[e+1]=t[e+3],t[e+3]=n},_doCryptBlock:function(t,e,n,o,r,i,s,a){for(var c=this._nRounds,u=t[e]^n[0],l=t[e+1]^n[1],p=t[e+2]^n[2],h=t[e+3]^n[3],d=4,f=1;f<c;f++){var m=o[u>>>24]^r[l>>>16&255]^i[p>>>8&255]^s[255&h]^n[d++],y=o[l>>>24]^r[p>>>16&255]^i[h>>>8&255]^s[255&u]^n[d++],_=o[p>>>24]^r[h>>>16&255]^i[u>>>8&255]^s[255&l]^n[d++],g=o[h>>>24]^r[u>>>16&255]^i[l>>>8&255]^s[255&p]^n[d++];u=m,l=y,p=_,h=g}var m=(a[u>>>24]<<24|a[l>>>16&255]<<16|a[p>>>8&255]<<8|a[255&h])^n[d++],y=(a[l>>>24]<<24|a[p>>>16&255]<<16|a[h>>>8&255]<<8|a[255&u])^n[d++],_=(a[p>>>24]<<24|a[h>>>16&255]<<16|a[u>>>8&255]<<8|a[255&l])^n[d++],g=(a[h>>>24]<<24|a[u>>>16&255]<<16|a[l>>>8&255]<<8|a[255&p])^n[d++];t[e]=m,t[e+1]=y,t[e+2]=_,t[e+3]=g},keySize:8});e.AES=o._createHelper(y)}(),t.AES})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(3),n(4),n(2),n(1)):(r=[n(0),n(3),n(4),n(2),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(){function e(t,e){var n=(this._lBlock>>>t^this._rBlock)&e;this._rBlock^=n,this._lBlock^=n<<t}function n(t,e){var n=(this._rBlock>>>t^this._lBlock)&e;this._lBlock^=n,this._rBlock^=n<<t}var o=t,r=o.lib,i=r.WordArray,s=r.BlockCipher,a=o.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],u=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],p=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],h=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=a.DES=s.extend({_doReset:function(){for(var t=this._key,e=t.words,n=[],o=0;o<56;o++){var r=c[o]-1;n[o]=e[r>>>5]>>>31-r%32&1}for(var i=this._subKeys=[],s=0;s<16;s++){for(var a=i[s]=[],p=l[s],o=0;o<24;o++)a[o/6|0]|=n[(u[o]-1+p)%28]<<31-o%6,a[4+(o/6|0)]|=n[28+(u[o+24]-1+p)%28]<<31-o%6;a[0]=a[0]<<1|a[0]>>>31;for(var o=1;o<7;o++)a[o]=a[o]>>>4*(o-1)+3;a[7]=a[7]<<5|a[7]>>>27}for(var h=this._invSubKeys=[],o=0;o<16;o++)h[o]=i[15-o]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._subKeys)},decryptBlock:function(t,e){this._doCryptBlock(t,e,this._invSubKeys)},_doCryptBlock:function(t,o,r){this._lBlock=t[o],this._rBlock=t[o+1],e.call(this,4,252645135),e.call(this,16,65535),n.call(this,2,858993459),n.call(this,8,16711935),e.call(this,1,1431655765);for(var i=0;i<16;i++){for(var s=r[i],a=this._lBlock,c=this._rBlock,u=0,l=0;l<8;l++)u|=p[l][((c^s[l])&h[l])>>>0];this._lBlock=c,this._rBlock=a^u}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,e.call(this,1,1431655765),n.call(this,8,16711935),n.call(this,2,858993459),e.call(this,16,65535),e.call(this,4,252645135),t[o]=this._lBlock,t[o+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});o.DES=s._createHelper(d);var f=a.TripleDES=s.extend({_doReset:function(){var t=this._key,e=t.words;this._des1=d.createEncryptor(i.create(e.slice(0,2))),this._des2=d.createEncryptor(i.create(e.slice(2,4))),this._des3=d.createEncryptor(i.create(e.slice(4,6)))},encryptBlock:function(t,e){this._des1.encryptBlock(t,e),this._des2.decryptBlock(t,e),this._des3.encryptBlock(t,e)},decryptBlock:function(t,e){this._des3.decryptBlock(t,e),this._des2.encryptBlock(t,e),this._des1.decryptBlock(t,e)},keySize:6,ivSize:2,blockSize:2});o.TripleDES=s._createHelper(f)}(),t.TripleDES})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(3),n(4),n(2),n(1)):(r=[n(0),n(3),n(4),n(2),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(){function e(){for(var t=this._S,e=this._i,n=this._j,o=0,r=0;r<4;r++){e=(e+1)%256,n=(n+t[e])%256;var i=t[e];t[e]=t[n],t[n]=i,o|=t[(t[e]+t[n])%256]<<24-8*r}return this._i=e,this._j=n,o}var n=t,o=n.lib,r=o.StreamCipher,i=n.algo,s=i.RC4=r.extend({_doReset:function(){for(var t=this._key,e=t.words,n=t.sigBytes,o=this._S=[],r=0;r<256;r++)o[r]=r;for(var r=0,i=0;r<256;r++){var s=r%n,a=e[s>>>2]>>>24-s%4*8&255;i=(i+o[r]+a)%256;var c=o[r];o[r]=o[i],o[i]=c}this._i=this._j=0},_doProcessBlock:function(t,n){t[n]^=e.call(this)},keySize:8,ivSize:0});n.RC4=r._createHelper(s);var a=i.RC4Drop=s.extend({cfg:s.cfg.extend({drop:192}),_doReset:function(){s._doReset.call(this);for(var t=this.cfg.drop;t>0;t--)e.call(this)}});n.RC4Drop=r._createHelper(a)}(),t.RC4})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(3),n(4),n(2),n(1)):(r=[n(0),n(3),n(4),n(2),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(){function e(){for(var t=this._X,e=this._C,n=0;n<8;n++)a[n]=e[n];e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<a[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<a[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<a[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<a[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<a[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<a[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<a[6]>>>0?1:0)|0,this._b=e[7]>>>0<a[7]>>>0?1:0;for(var n=0;n<8;n++){var o=t[n]+e[n],r=65535&o,i=o>>>16,s=((r*r>>>17)+r*i>>>15)+i*i,u=((4294901760&o)*o|0)+((65535&o)*o|0);c[n]=s^u}t[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,t[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,t[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,t[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,t[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,t[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,t[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,t[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}var n=t,o=n.lib,r=o.StreamCipher,i=n.algo,s=[],a=[],c=[],u=i.Rabbit=r.extend({_doReset:function(){for(var t=this._key.words,n=this.cfg.iv,o=0;o<4;o++)t[o]=16711935&(t[o]<<8|t[o]>>>24)|4278255360&(t[o]<<24|t[o]>>>8);var r=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],i=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];this._b=0;for(var o=0;o<4;o++)e.call(this);for(var o=0;o<8;o++)i[o]^=r[o+4&7];if(n){var s=n.words,a=s[0],c=s[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8),p=u>>>16|4294901760&l,h=l<<16|65535&u;i[0]^=u,i[1]^=p,i[2]^=l,i[3]^=h,i[4]^=u,i[5]^=p,i[6]^=l,i[7]^=h;for(var o=0;o<4;o++)e.call(this)}},_doProcessBlock:function(t,n){var o=this._X;e.call(this),s[0]=o[0]^o[5]>>>16^o[3]<<16,s[1]=o[2]^o[7]>>>16^o[5]<<16,s[2]=o[4]^o[1]>>>16^o[7]<<16,s[3]=o[6]^o[3]>>>16^o[1]<<16;for(var r=0;r<4;r++)s[r]=16711935&(s[r]<<8|s[r]>>>24)|4278255360&(s[r]<<24|s[r]>>>8),t[n+r]^=s[r]},blockSize:4,ivSize:2});n.Rabbit=r._createHelper(u)}(),t.Rabbit})},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,c,u){"object"===s(e)?t.exports=e=c(n(0),n(3),n(4),n(2),n(1)):(r=[n(0),n(3),n(4),n(2),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i))}(0,function(t){return function(){function e(){for(var t=this._X,e=this._C,n=0;n<8;n++)a[n]=e[n];e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<a[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<a[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<a[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<a[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<a[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<a[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<a[6]>>>0?1:0)|0,this._b=e[7]>>>0<a[7]>>>0?1:0;for(var n=0;n<8;n++){var o=t[n]+e[n],r=65535&o,i=o>>>16,s=((r*r>>>17)+r*i>>>15)+i*i,u=((4294901760&o)*o|0)+((65535&o)*o|0);c[n]=s^u}t[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,t[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,t[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,t[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,t[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,t[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,t[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,t[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}var n=t,o=n.lib,r=o.StreamCipher,i=n.algo,s=[],a=[],c=[],u=i.RabbitLegacy=r.extend({_doReset:function(){var t=this._key.words,n=this.cfg.iv,o=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],r=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];this._b=0;for(var i=0;i<4;i++)e.call(this);for(var i=0;i<8;i++)r[i]^=o[i+4&7];if(n){var s=n.words,a=s[0],c=s[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8),p=u>>>16|4294901760&l,h=l<<16|65535&u;r[0]^=u,r[1]^=p,r[2]^=l,r[3]^=h,r[4]^=u,r[5]^=p,r[6]^=l,r[7]^=h;for(var i=0;i<4;i++)e.call(this)}},_doProcessBlock:function(t,n){var o=this._X;e.call(this),s[0]=o[0]^o[5]>>>16^o[3]<<16,s[1]=o[2]^o[7]>>>16^o[5]<<16,s[2]=o[4]^o[1]>>>16^o[7]<<16,s[3]=o[6]^o[3]>>>16^o[1]<<16;for(var r=0;r<4;r++)s[r]=16711935&(s[r]<<8|s[r]>>>24)|4278255360&(s[r]<<24|s[r]>>>8),t[n+r]^=s[r]},blockSize:4,ivSize:2});n.RabbitLegacy=r._createHelper(u)}(),t.RabbitLegacy})},function(t,e,n){"use strict";var o=n(37),r=function(t){return t&&t.__esModule?t:{default:t}}(o),i=new r.default.connection({});i.listen({}),i.open({})},function(module,exports,__webpack_require__){"use strict";function _parsePrivacy(t){var e={},n=t.getElementsByTagName("item");if(n)for(var o=0;o<n.length;o++){var r=n[o],i=r.getAttribute("value"),s=r.getAttribute("order"),a=r.getAttribute("type");if(i){var c=_parseNameFromJidFn(i);e[c]={type:a,order:s,jid:i,name:c}}}return e}function _parseGroupBlacklist(t){var e={},n=t.getElementsByTagName("item");if(n)for(var o=0;o<n.length;o++){var r=n[o],i=r.getAttribute("jid"),s=r.getAttribute("affiliation"),a=r.getAttribute("nick");if(i){var c=_parseNameFromJidFn(i);e[c]={jid:i,affiliation:s,nick:a,name:c}}}return e}function _setText(t,e){"textContent"in t?t.textContent=e:"text"in t&&(t.text=e)}var _version="1.4.13",_code=__webpack_require__(10).code,_utils=__webpack_require__(11).utils,_msg=__webpack_require__(38),_message=_msg._msg,_msgHash={},Queue=__webpack_require__(39).Queue,CryptoJS=__webpack_require__(12),Strophe=__webpack_require__(40),isStropheLog,stropheConn=null;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;var logMessage=function(t){};window.XDomainRequest,Strophe.log=function(t,e){if(isStropheLog)switch(t){case this.LogLevel.DEBUG:console.debug(e);break;case this.LogLevel.INFO:console.info(e);break;case this.LogLevel.WARN:console.warn(e);break;case this.LogLevel.ERROR:case this.LogLevel.FATAL:console.error(e);break;default:console.log(e)}};var _parseRoom=function(t){var e=[],n=t.getElementsByTagName("item");if(n)for(var o=0;o<n.length;o++){var r=n[o],i=r.getAttribute("jid"),s=i.split("@")[0],a={jid:i,name:r.getAttribute("name"),roomId:s.split("_")[1]};e.push(a)}return e},_parseRoomOccupants=function(t){var e=[],n=t.getElementsByTagName("item");if(n)for(var o=0;o<n.length;o++){var r=n[o],i={jid:r.getAttribute("jid"),name:r.getAttribute("name")};e.push(i)}return e},_parseResponseMessage=function _parseResponseMessage(msginfo){var parseMsgData={errorMsg:!0,data:[]},msgBodies=msginfo.getElementsByTagName("body");if(msgBodies){for(var i=0;i<msgBodies.length;i++){var msgBody=msgBodies[i],childNodes=msgBody.childNodes;if(childNodes&&childNodes.length>0){var childNode=msgBody.childNodes[0];if(childNode.nodeType==Strophe.ElementType.TEXT){var jsondata=childNode.wholeText||childNode.nodeValue;jsondata=jsondata.replace("\n","<br>");try{var data=eval("("+jsondata+")");parseMsgData.errorMsg=!1,parseMsgData.data=[data]}catch(t){}}}}var delayTags=msginfo.getElementsByTagName("delay");if(delayTags&&delayTags.length>0){var delayTag=delayTags[0],delayMsgTime=delayTag.getAttribute("stamp");delayMsgTime&&(parseMsgData.delayTimeStamp=delayMsgTime)}}else{var childrens=msginfo.childNodes;if(childrens&&childrens.length>0){var child=msginfo.childNodes[0];if(child.nodeType==Strophe.ElementType.TEXT)try{var data=eval("("+child.nodeValue+")");parseMsgData.errorMsg=!1,parseMsgData.data=[data]}catch(t){}}}return parseMsgData},_parseNameFromJidFn=function(t,e){e=e||"";var n=t,o=n.indexOf("_");-1!==o&&(n=n.substring(o+1));var r=n.indexOf("@"+e);return-1!==r&&(n=n.substring(0,r)),n},_parseFriend=function(t,e,n){var o=[],r=t.getElementsByTagName("item");if(r)for(var i=0;i<r.length;i++){var s=r[i],a=s.getAttribute("jid");if(a){var c=s.getAttribute("subscription"),u={subscription:c,jid:a},l=s.getAttribute("ask");l&&(u.ask=l);var p=s.getAttribute("name");if(p)u.name=p;else{var h=_parseNameFromJidFn(a);u.name=h}var d=[];Strophe.forEachChild(s,"group",function(t){d.push(Strophe.getText(t))}),u.groups=d,o.push(u),e&&"from"==c&&!l&&e.subscribe({toJid:a,message:"[resp:true]"}),e&&"to"==c&&e.subscribed({toJid:a})}}return o},_login=function(t,e){var n=t.access_token||"";if(""==n){_utils.stringify(t);return void e.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:t})}e.context.accessToken=t.access_token,e.context.accessTokenExpires=t.expires_in,stropheConn=e.isOpening()&&e.context.stropheConn?e.getStrophe():(e.isOpened()&&e.context.stropheConn,e.getStrophe());var o=function(t,n){_loginCallback(t,n,e)};e.context.stropheConn=stropheConn,e.route?stropheConn.connect(e.context.jid,"$t$"+n,o,e.wait,e.hold,e.route):stropheConn.connect(e.context.jid,"$t$"+n,o,e.wait,e.hold)},_parseMessageType=function(t){var e=t.getElementsByTagName("received"),n=t.getElementsByTagName("invite"),o=t.getElementsByTagName("delivery"),r=t.getElementsByTagName("acked"),i=t.getElementsByTagName("error"),s="normal";if(e&&e.length>0&&"urn:xmpp:receipts"===e[0].namespaceURI)s="received";else if(n&&n.length>0)s="invite";else if(o&&o.length>0)s="delivery";else if(r&&r.length)s="acked";else if(i&&i.length){var a=i[0],c=a.getElementsByTagName("user-muted");c&&c.length&&(s="userMuted")}return s},_handleMessageQueue=function(t){for(var e in _msgHash)_msgHash.hasOwnProperty(e)&&_msgHash[e].send(t)},_loginCallback=function(t,e,n){var o,r;if("conflict"===e&&(o=!0,n.close()),t==Strophe.Status.CONNFAIL)r={type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:e,reconnect:!0},o&&(r.conflict=!0),n.onError(r);else if(t==Strophe.Status.ATTACHED||t==Strophe.Status.CONNECTED){n.autoReconnectNumTotal=0,n.intervalId=setInterval(function(){n.handelSendQueue()},200);var i=function(t){var e=t.getElementsByTagName("delivery"),o=t.getElementsByTagName("acked");if(e.length)return n.handleDeliveredMessage(t),!0;if(o.length)return n.handleAckedMessage(t),!0;switch(_parseMessageType(t)){case"received":return n.handleReceivedMessage(t),!0;case"invite":return n.handleInviteMessage(t),!0;case"delivery":return n.handleDeliveredMessage(t),!0;case"acked":return n.handleAckedMessage(t),!0;case"userMuted":return n.handleMutedMessage(t),!0;default:return n.handleMessage(t),!0}},s=function(t){return n.handlePresence(t),!0},a=function(t){return n.handlePing(t),!0},c=function(t){return n.handleIqRoster(t),!0},u=function(t){return n.handleIqPrivacy(t),!0},l=function(t){return n.handleIq(t),!0};n.addHandler(i,null,"message",null,null,null),n.addHandler(s,null,"presence",null,null,null),n.addHandler(a,"urn:xmpp:ping","iq","get",null,null),n.addHandler(c,"jabber:iq:roster","iq","set",null,null),n.addHandler(u,"jabber:iq:privacy","iq","set",null,null),n.addHandler(l,null,"iq",null,null,null),n.registerConfrIQHandler&&n.registerConfrIQHandler(),n.context.status=_code.STATUS_OPENED;var p=[_code.WEBIM_MESSAGE_REC_TEXT,_code.WEBIM_MESSAGE_REC_EMOJI];_utils.isCanDownLoadFile&&(p.push(_code.WEBIM_MESSAGE_REC_PHOTO),p.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE));var h=[_code.WEBIM_MESSAGE_SED_TEXT];_utils.isCanUploadFile&&(h.push(_code.WEBIM_MESSAGE_REC_PHOTO),h.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE)),n.notifyVersion(),n.retry&&_handleMessageQueue(n),n.heartBeat(),n.isAutoLogin&&n.setPresence(),console.log("conn",n);try{if(n.unSendMsgArr.length>0){console.log("unSendMesArr",n.unSendMsgArr);for(var d in n.unSendMsgArr){var f=n.unSendMsgArr[d];n.sendCommand(f),delete n.unSendMsgArr[d]}}}catch(t){console.error(t.message)}n.offLineSendConnecting=!1,n.logOut=!1,n.onOpened({canReceive:p,canSend:h,accessToken:n.context.accessToken})}else if(t==Strophe.Status.DISCONNECTING)n.isOpened()&&(n.stopHeartBeat(),n.context.status=_code.STATUS_CLOSING,r={type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:e,reconnect:!0},o&&(r.conflict=!0),n.onError(r));else if(t==Strophe.Status.DISCONNECTED){if(n.isOpened()){if(n.autoReconnectNumTotal<n.autoReconnectNumMax)return void n.reconnect();r={type:_code.WEBIM_CONNCTION_DISCONNECTED},n.onError(r)}n.context.status=_code.STATUS_CLOSED,n.clear(),n.onClosed()}else t==Strophe.Status.AUTHFAIL?(r={type:_code.WEBIM_CONNCTION_AUTH_ERROR},o&&(r.conflict=!0),n.onError(r),n.clear()):t==Strophe.Status.ERROR&&(n.context.status=_code.STATUS_ERROR,r={type:_code.WEBIM_CONNCTION_SERVER_ERROR},o&&(r.conflict=!0),n.onError(r));n.context.status_now=t},_getJid=function(t,e){var n=t.toJid||"";if(""===n){var o=e.context.appKey||"",r=o+"_"+t.to+"@"+e.domain;t.resource&&(r=r+"/"+t.resource),n=r}return n},_getJidByName=function(t,e){return _getJid({to:t},e)},_validCheck=function(t,e){if(t=t||{},""==t.user)return e.onError({type:_code.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR}),!1;var n=t.user+""||"",o=t.appKey||"",r=o.split("#");if(2!==r.length)return e.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var i=r[0],s=r[1];if(!i)return e.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;if(!s)return e.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var a=o+"_"+n.toLowerCase()+"@"+e.domain,c=t.resource||"webim";return e.isMultiLoginSessions&&(c+=n+(new Date).getTime()+Math.floor(1e6*Math.random().toFixed(6))),e.context.jid=a+"/"+c,e.context.userId=n,e.context.appKey=o,e.context.appName=s,e.context.orgName=i,!0},_getXmppUrl=function(t,e){if(/^(ws|http)s?:\/\/?/.test(t))return t;var n={prefix:"http",base:"://"+t,suffix:"/http-bind/"};return e&&_utils.isSupportWss?(n.prefix="wss",n.suffix="/ws/"):e?n.prefix="https":window.WebSocket&&(n.prefix="ws",n.suffix="/ws/"),n.prefix+n.base+n.suffix},connection=function t(e){if(!this instanceof t)return new t(e);var e=e||{};this.isHttpDNS=e.isHttpDNS||!1,this.isMultiLoginSessions=e.isMultiLoginSessions||!1,this.wait=e.wait||30,this.retry=e.retry||!1,this.https=e.https||"https:"===location.protocol,this.url=_getXmppUrl(e.url,this.https),this.hold=e.hold||1,this.route=e.route||null,this.domain=e.domain||"easemob.com",this.inactivity=e.inactivity||30,this.heartBeatWait=e.heartBeatWait||4500,this.maxRetries=e.maxRetries||5,this.isAutoLogin=!1!==e.isAutoLogin,this.pollingTime=e.pollingTime||800,this.stropheConn=!1,this.autoReconnectNumMax=e.autoReconnectNumMax||0,this.autoReconnectNumTotal=0,this.autoReconnectInterval=e.autoReconnectInterval||0,this.context={status:_code.STATUS_INIT},this.sendQueue=new Queue,this.intervalId=null,this.apiUrl=e.apiUrl||"",this.isWindowSDK=e.isWindowSDK||!1,this.encrypt=e.encrypt||{encrypt:{type:"none"}},this.delivery=e.delivery||!1,this.user="",this.orgName="",this.appName="",this.token="",this.unSendMsgArr=[],this.dnsArr=["https://rs.easemob.com","https://rsbak.easemob.com","http://182.92.174.78","http://112.126.66.111"],this.dnsIndex=0,this.dnsTotal=this.dnsArr.length,this.restHosts=null,this.restIndex=0,this.restTotal=0,this.xmppHosts=null,this.xmppIndex=0,this.xmppTotal=0,this.groupOption={},isStropheLog=e.isStropheLog||!1};connection.prototype.registerUser=function(t){"https:"!=location.protocol&&this.isHttpDNS?(this.dnsIndex=0,this.getHttpDNS(t,"signup")):this.signup(t)},connection.prototype.handelSendQueue=function(){var t=this.sendQueue.pop();null!==t&&this.sendReceiptsMessage(t)},connection.prototype.listen=function(t){this.onOpened=t.onOpened||_utils.emptyfn,this.onClosed=t.onClosed||_utils.emptyfn,this.onTextMessage=t.onTextMessage||_utils.emptyfn,this.onEmojiMessage=t.onEmojiMessage||_utils.emptyfn,this.onPictureMessage=t.onPictureMessage||_utils.emptyfn,this.onAudioMessage=t.onAudioMessage||_utils.emptyfn,this.onVideoMessage=t.onVideoMessage||_utils.emptyfn,this.onFileMessage=t.onFileMessage||_utils.emptyfn,this.onLocationMessage=t.onLocationMessage||_utils.emptyfn,this.onCmdMessage=t.onCmdMessage||_utils.emptyfn,this.onPresence=t.onPresence||_utils.emptyfn,this.onRoster=t.onRoster||_utils.emptyfn,this.onError=t.onError||_utils.emptyfn,this.onReceivedMessage=t.onReceivedMessage||_utils.emptyfn,this.onInviteMessage=t.onInviteMessage||_utils.emptyfn,this.onDeliverdMessage=t.onDeliveredMessage||_utils.emptyfn,this.onReadMessage=t.onReadMessage||_utils.emptyfn,this.onMutedMessage=t.onMutedMessage||_utils.emptyfn,this.onOffline=t.onOffline||_utils.emptyfn,this.onOnline=t.onOnline||_utils.emptyfn,this.onConfirmPop=t.onConfirmPop||_utils.emptyfn,this.onCreateGroup=t.onCreateGroup||_utils.emptyfn,this.onUpdateMyGroupList=t.onUpdateMyGroupList||_utils.emptyfn,this.onUpdateMyRoster=t.onUpdateMyRoster||_utils.emptyfn,this.onBlacklistUpdate=t.onBlacklistUpdate||_utils.emptyfn,_listenNetwork(this.onOnline,this.onOffline)},connection.prototype.heartBeat=function(t){!0!==t&&(t=!1);var e=this,n=!/^ws|wss/.test(e.url)||/mobile/.test(navigator.userAgent);if(!this.heartBeatID&&(t||n)){var o={toJid:this.domain,type:"normal"};this.heartBeatID=setInterval(function(){_utils.isSupportWss&&e.ping(o)},this.heartBeatWait)}},connection.prototype.stopHeartBeat=function(){"number"==typeof this.heartBeatID&&(this.heartBeatID=clearInterval(this.heartBeatID))},connection.prototype.sendReceiptsMessage=function(t){var e=$msg({from:this.context.jid||"",to:this.domain,id:t.id||""}).c("received",{xmlns:"urn:xmpp:receipts",id:t.id||""});this.sendCommand(e.tree())},connection.prototype.cacheReceiptsMessage=function(t){this.sendQueue.push(t)},connection.prototype.getStrophe=function(){if("https:"!=location.protocol&&this.isHttpDNS){var t="",e=this.xmppHosts[this.xmppIndex],n=_utils.getXmlFirstChild(e,"domain"),o=_utils.getXmlFirstChild(e,"ip");if(o){t=o.textContent;var r=_utils.getXmlFirstChild(e,"port");"80"!=r.textContent&&(t+=":"+r.textContent)}else t=n.textContent;if(""!=t){var i=/(.+\/\/).+(\/.+)/;this.url=this.url.replace(i,"$1"+t+"$2")}}return new Strophe.Connection(this.url,{inactivity:this.inactivity,maxRetries:this.maxRetries,pollingTime:this.pollingTime})},connection.prototype.getHostsByTag=function(t,e){var n=_utils.getXmlFirstChild(t,e);if(!n)return console.log(e+" hosts error"),null;var o=n.getElementsByTagName("hosts");return 0==o.length?(console.log(e+" hosts error2"),null):o[0].getElementsByTagName("host")},connection.prototype.getRestFromHttpDNS=function(t,e){if(this.restIndex>this.restTotal)return void console.log("rest hosts all tried,quit");var n="",o=this.restHosts[this.restIndex],r=_utils.getXmlFirstChild(o,"domain"),i=_utils.getXmlFirstChild(o,"ip");if(i){var s=_utils.getXmlFirstChild(o,"port");n=("https:"===location.protocol?"https:":"http:")+"//"+i.textContent+":"+s.textContent}else n=("https:"===location.protocol?"https:":"http:")+"//"+r.textContent;""!=n&&(this.apiUrl=n,t.apiUrl=n),"login"==e?this.login(t):this.signup(t)},connection.prototype.getHttpDNS=function(t,e){if(this.restHosts)return void this.getRestFromHttpDNS(t,e);var n=this,o=function(o,r){o=(new DOMParser).parseFromString(o,"text/xml").documentElement;var i=n.getHostsByTag(o,"rest");if(!i)return void console.log("rest hosts error3");n.restHosts=i,n.restTotal=i.length;var s=n.getHostsByTag(o,"xmpp");if(!s)return void console.log("xmpp hosts error3");n.xmppHosts=s,n.xmppTotal=s.length,n.getRestFromHttpDNS(t,e)},r=function(o,r,i){console.log("getHttpDNS error",o,i),++n.dnsIndex<n.dnsTotal&&n.getHttpDNS(t,e)},i={url:this.dnsArr[this.dnsIndex]+"/easemob/server.xml",dataType:"text",type:"GET",data:{app_key:encodeURIComponent(t.appKey)},success:o||_utils.emptyfn,error:r||_utils.emptyfn};_utils.ajax(i)},connection.prototype.signup=function(t){var e=this,n=t.orgName||"",o=t.appName||"",r=t.appKey||"",i=t.success||EMPTYFN,s=t.error||EMPTYFN;if(!n&&!o&&r){var a=r.split("#");2===a.length&&(n=a[0],o=a[1])}if(!n&&!o)return void s({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR});var c=function(n,o,r){if("https:"!=location.protocol&&e.isHttpDNS&&e.restIndex+1<e.restTotal)return e.restIndex++,void e.getRestFromHttpDNS(t,"signup");e.clear(),s(n)},u=t.https||u,l=t.apiUrl,p=l+"/"+n+"/"+o+"/users",h={username:t.username,password:t.password,nickname:t.nickname||""},d=_utils.stringify(h),f={url:p,dataType:"json",data:d,success:i,error:c};_utils.ajax(f)},connection.prototype.open=function(t){var e=t.appKey,n=e.split("#")[0],o=e.split("#")[1];this.orgName=n,this.appName=o,t.accessToken&&(this.token=t.accessToken),t.xmppURL&&(this.url=_getXmppUrl(t.xmppURL,this.https)),"https:"!=location.protocol&&this.isHttpDNS?(this.dnsIndex=0,this.getHttpDNS(t,"login")):this.login(t)},connection.prototype.login=function(t){if(this.user=t.user,_validCheck(t,this)){var e=this;if(!e.isOpened())if(t.accessToken)t.access_token=t.accessToken,e.context.restTokenData=t,_login(t,e);else{var n=t.apiUrl,o=this.context.userId,r=t.pwd||"",i=this.context.appName,s=this.context.orgName,a=function(n,o){e.context.status=_code.STATUS_DOLOGIN_IM,e.context.restTokenData=n,t.success&&t.success(n),e.token=n.access_token,_login(n,e)},c=function(n,o,r){if(t.error&&t.error(),"https:"!=location.protocol&&e.isHttpDNS&&e.restIndex+1<e.restTotal)return e.restIndex++,void e.getRestFromHttpDNS(t,"login");e.clear(),n.error&&n.error_description?e.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:n,xhr:o}):e.onError({type:_code.WEBIM_CONNCTION_OPEN_ERROR,data:n,xhr:o})};this.context.status=_code.STATUS_DOLOGIN_USERGRID;var u={grant_type:"password",username:o,password:r,timestamp:+new Date},l=_utils.stringify(u),p={url:n+"/"+s+"/"+i+"/token",dataType:"json",data:l,success:a||_utils.emptyfn,error:c||_utils.emptyfn};_utils.ajax(p)}}},connection.prototype.attach=function(t){if(_validCheck(t,this)){t=t||{};var e=t.accessToken||"";if(""==e)return void this.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR});var n=t.sid||"";if(""===n)return void this.onError({type:_code.WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR});var o=t.rid||"";if(""===o)return void this.onError({type:_code.WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR});var r=this.getStrophe();this.context.accessToken=e,this.context.stropheConn=r,this.context.status=_code.STATUS_DOLOGIN_IM;var i=this,s=function(t,e){_loginCallback(t,e,i)},a=this.context.jid,c=this.wait,u=this.hold,l=this.wind||5;r.attach(a,n,o,s,c,u,l)}},connection.prototype.close=function(t){this.logOut=!0,this.stopHeartBeat(),this.context.status!=_code.STATUS_INIT&&(this.isClosed()||this.isClosing()||(this.context.status=_code.STATUS_CLOSING,this.context.stropheConn.disconnect(t)))},connection.prototype.addHandler=function(t,e,n,o,r,i,s){this.context.stropheConn.addHandler(t,e,n,o,r,i,s)},connection.prototype.notifyVersion=function(t,e){var n=(_getJid({},this),$iq({from:this.context.jid||"",to:this.domain,type:"result"}).c("query",{xmlns:"jabber:iq:version"}).c("name").t("easemob").up().c("version").t(_version).up().c("os").t("webim")),t=t||_utils.emptyfn,o=e||this.onError,r=function(t){o({type:_code.WEBIM_CONNCTION_NOTIFYVERSION_ERROR,data:t})};this.context.stropheConn.sendIQ(n.tree(),t,r)},connection.prototype.handlePresence=function(t){if(!this.isClosed()){var e=t.getAttribute("from")||"",n=t.getAttribute("to")||"",o=t.getAttribute("type")||"",r=t.getAttribute("presence_type")||"",i=_parseNameFromJidFn(e),s=_parseNameFromJidFn(n),a=!1,c=!1,u=!1,l=!1,p={from:i,to:s,fromJid:e,toJid:n,type:o,chatroom:!!t.getElementsByTagName("roomtype").length},h=t.getElementsByTagName("show");if(h&&h.length>0){var d=h[0];p.show=Strophe.getText(d)}var f=t.getElementsByTagName("status");if(f&&f.length>0){var m=f[0];p.status=Strophe.getText(m),p.code=m.getAttribute("code")}var y=t.getElementsByTagName("priority");if(y&&y.length>0){var _=y[0];p.priority=Strophe.getText(_)}var g=t.getElementsByTagName("error");if(g&&g.length>0){var g=g[0];p.error={code:g.getAttribute("code")}}var v=t.getElementsByTagName("destroy");if(v&&v.length>0){var v=v[0];p.destroy=!0;var b=v.getElementsByTagName("reason");b&&b.length>0&&(p.reason=Strophe.getText(b[0]))}var S=t.getElementsByTagName("item");if(S&&S.length>0){var N=S[0],E=N.getAttribute("role"),T=N.getAttribute("jid"),x=N.getAttribute("affiliation");if("none"==E&&T){var O=_parseNameFromJidFn(T),I=N.getElementsByTagName("actor")[0],C=I.getAttribute("nick");p.actor=C,p.kicked=O}"moderator"==E&&"201"==p.code&&"owner"===x&&(p.type="createGroupACK",a=!0)}var R=t.getElementsByTagName("x");if(R&&R.length>0){var A=R[0].getElementsByTagName("apply"),M=R[0].getElementsByTagName("accept"),w=R[0].getElementsByTagName("item"),B=R[0].getElementsByTagName("decline"),k=R[0].getElementsByTagName("add_admin"),D=R[0].getElementsByTagName("remove_admin"),j=R[0].getElementsByTagName("add_mute"),H=R[0].getElementsByTagName("remove_mute");if(A&&A.length>0){l=!0,p.toNick=A[0].getAttribute("toNick"),p.type="joinGroupNotifications";var L=A[0].getAttribute("to"),F=L.split("@")[0].split("_");F=F[F.length-1],p.gid=F}else if(M&&M.length>0)p.type="joinPublicGroupSuccess";else if(w&&w.length>0){var x=w[0].getAttribute("affiliation"),E=w[0].getAttribute("role");if("member"==x||"participant"==E){c=!0,p.mid=p.fromJid.split("/"),p.mid=p.mid[p.mid.length-1],p.type="memberJoinPublicGroupSuccess";var U=t.getElementsByTagName("roomtype");if(U&&U.length>0){var o=U[0].getAttribute("type");"chatroom"==o&&(p.type="memberJoinChatRoomSuccess")}}}else if(B&&B.length){u=!0;var F=B[0].getAttribute("fromNick"),W=_parseNameFromJidFn(B[0].getAttribute("from"));p.type="joinPublicGroupDeclined",p.owner=W,p.gid=F}else if(k&&k.length>0){var F=_parseNameFromJidFn(k[0].getAttribute("mucjid")),W=_parseNameFromJidFn(k[0].getAttribute("from"));p.owner=W,p.gid=F,p.type="addAdmin"}else if(D&&D.length>0){var F=_parseNameFromJidFn(D[0].getAttribute("mucjid")),W=_parseNameFromJidFn(D[0].getAttribute("from"));p.owner=W,p.gid=F,p.type="removeAdmin"}else if(j&&j.length>0){var F=_parseNameFromJidFn(j[0].getAttribute("mucjid")),W=_parseNameFromJidFn(j[0].getAttribute("from"));p.owner=W,p.gid=F,p.type="addMute"}else if(H&&H.length>0){var F=_parseNameFromJidFn(H[0].getAttribute("mucjid")),W=_parseNameFromJidFn(H[0].getAttribute("from"));p.owner=W,p.gid=F,p.type="removeMute"}}if(p.chatroom){p.presence_type=r,p.original_type=p.type;e.slice(e.lastIndexOf("/")+1)===this.context.userId&&(""!==p.type||p.code?"unavailable"!==r&&"unavailable"!==p.type||(p.status?110==p.code?p.type="leaveChatRoom":p.error&&406==p.error.code&&(p.type="reachChatRoomCapacity"):p.type="leaveChatRoom"):p.type="joinChatRoomSuccess")}else if(p.presence_type=r,p.original_type=o,/subscribe/.test(p.type));else if(""!=o||p.status||p.error||a||l||c||u){if("unavailable"===r||"unavailable"===o)if(p.destroy)p.type="deleteGroupChat";else if(307==p.code||321==p.code){var q=t.getAttribute("nick");p.type=q?"removedFromGroup":"leaveGroup"}}else console.log(2222222,t,p,l);this.onPresence(p,t)}},connection.prototype.handlePing=function(t){if(!this.isClosed()){var e=t.getAttribute("id"),n=t.getAttribute("from"),o=t.getAttribute("to"),r=$iq({from:o,to:n,id:e,type:"result"});this.sendCommand(r.tree())}},connection.prototype.handleIq=function(t){return!0},connection.prototype.handleIqPrivacy=function(t){0!=t.getElementsByTagName("list").length&&this.getBlacklist()},connection.prototype.handleIqRoster=function(t){var e=t.getAttribute("id"),n=t.getAttribute("from")||"",o=(_parseNameFromJidFn(n),this.context.jid),r=(this.context.userId,$iq({type:"result",id:e,from:o}));this.sendCommand(r.tree());var i=t.getElementsByTagName("query");if(i&&i.length>0){var s=i[0],a=_parseFriend(s,this,n);this.onRoster(a)}return!0},connection.prototype.handleMessage=function(t){var e=this;if(!this.isClosed()){var n=t.getAttribute("id")||"";this.cacheReceiptsMessage({id:n});var o=_parseResponseMessage(t);if(o.errorMsg)return void this.handlePresence(t);var r=t.getElementsByTagName("error"),i="",s="",a=!1;if(r.length>0){a=!0,i=r[0].getAttribute("code");var c=r[0].getElementsByTagName("text");s=c[0].textContent||c[0].text}var u=o.data;for(var l in u)if(u.hasOwnProperty(l)){var p=u[l];if(p.from&&p.to){var h=(p.from+"").toLowerCase(),d=(p.to+"").toLowerCase(),f=p.ext||{},m="",y=t.getElementsByTagName("roomtype");m=y.length?y[0].getAttribute("type")||"chat":t.getAttribute("type")||"chat";var _=p.bodies;if(_&&0!=_.length){var g=p.bodies[0],v=g.type;try{switch(v){case"txt":var b=g.msg;if("base64"===e.encrypt.type)b=atob(b);else if("aes"===e.encrypt.type){var S=CryptoJS.enc.Utf8.parse(e.encrypt.key),N=CryptoJS.enc.Utf8.parse(e.encrypt.iv),E=e.encrypt.mode.toLowerCase(),T={};"cbc"===E?T={iv:N,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}:"ebc"===E&&(T={mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});var x=b,O=CryptoJS.AES.decrypt(x,S,T),I=O.toString(CryptoJS.enc.Utf8);b=I}var C=_utils.parseTextMessage(b,WebIM.Emoji);if(C.isemoji){var p={id:n,type:m,from:h,to:d,delay:o.delayTimeStamp,data:C.body,ext:f};!p.delay&&delete p.delay,p.error=a,p.errorText=s,p.errorCode=i,this.onEmojiMessage(p)}else{var p={id:n,type:m,from:h,to:d,delay:o.delayTimeStamp,data:b,ext:f};!p.delay&&delete p.delay,p.error=a,p.errorText=s,p.errorCode=i,this.onTextMessage(p)}break;case"img":var R=0,A=0;g.size&&(R=g.size.width,A=g.size.height);var p={id:n,type:m,from:h,to:d,url:"https:"!=location.protocol&&e.isHttpDNS?e.apiUrl+g.url.substr(g.url.indexOf("/",9)):g.url,secret:g.secret,filename:g.filename,thumb:g.thumb,thumb_secret:g.thumb_secret,file_length:g.file_length||"",width:R,height:A,filetype:g.filetype||"",accessToken:this.context.accessToken||"",ext:f,delay:o.delayTimeStamp};!p.delay&&delete p.delay,p.error=a,p.errorText=s,p.errorCode=i,this.onPictureMessage(p);break;case"audio":var p={id:n,type:m,from:h,to:d,url:"https:"!=location.protocol&&e.isHttpDNS?e.apiUrl+g.url.substr(g.url.indexOf("/",9)):g.url,secret:g.secret,filename:g.filename,length:g.length||"",file_length:g.file_length||"",filetype:g.filetype||"",accessToken:this.context.accessToken||"",ext:f,delay:o.delayTimeStamp};!p.delay&&delete p.delay,p.error=a,p.errorText=s,p.errorCode=i,this.onAudioMessage(p);break;case"file":var p={id:n,type:m,from:h,to:d,url:"https:"!=location.protocol&&e.isHttpDNS?e.apiUrl+g.url.substr(g.url.indexOf("/",9)):g.url,secret:g.secret,filename:g.filename,file_length:g.file_length,accessToken:this.context.accessToken||"",ext:f,delay:o.delayTimeStamp};!p.delay&&delete p.delay,p.error=a,p.errorText=s,p.errorCode=i,this.onFileMessage(p);break;case"loc":var p={id:n,type:m,from:h,to:d,addr:g.addr,lat:g.lat,lng:g.lng,ext:f,delay:o.delayTimeStamp};!p.delay&&delete p.delay,p.error=a,p.errorText=s,p.errorCode=i,this.onLocationMessage(p);break;case"video":var p={id:n,type:m,from:h,to:d,url:"https:"!=location.protocol&&e.isHttpDNS?e.apiUrl+g.url.substr(g.url.indexOf("/",9)):g.url,secret:g.secret,filename:g.filename,file_length:g.file_length,accessToken:this.context.accessToken||"",ext:f,delay:o.delayTimeStamp};!p.delay&&delete p.delay,p.error=a,p.errorText=s,p.errorCode=i,this.onVideoMessage(p);break;case"cmd":var p={id:n,from:h,to:d,action:g.action,ext:f,delay:o.delayTimeStamp};!p.delay&&delete p.delay,p.error=a,p.errorText=s,p.errorCode=i,this.onCmdMessage(p)}if(e.delivery){var M=e.getUniqueId(),w=p.id,B=new WebIM.message("delivery",M);B.set({id:w,to:p.from}),e.send(B.body)}}catch(t){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:t})}}}}}},connection.prototype.handleDeliveredMessage=function(t){var e=t.id,n=t.getElementsByTagName("body"),o=0;o=n[0].innerHTML;var r={mid:o};this.onDeliverdMessage(r),this.sendReceiptsMessage({id:e})},connection.prototype.handleAckedMessage=function(t){var e=t.id,n=t.getElementsByTagName("body"),o=0;o=n[0].innerHTML;var r={mid:o};this.onReadMessage(r),this.sendReceiptsMessage({id:e})},connection.prototype.handleReceivedMessage=function(t){try{var e=t.getElementsByTagName("received"),n=e[0].getAttribute("mid"),o=t.getElementsByTagName("body"),r=o[0].innerHTML,i={mid:n,id:r};this.onReceivedMessage(i)}catch(t){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:t})}var r,n,s=t.getElementsByTagName("received");if(s.length>0&&(r=s[0].childNodes&&s[0].childNodes.length>0?s[0].childNodes[0].nodeValue:s[0].innerHTML||s[0].innerText,n=s[0].getAttribute("mid")),_msgHash[r]){try{_msgHash[r].msg.success instanceof Function&&_msgHash[r].msg.success(r,n)}catch(t){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:t})}delete _msgHash[r]}},connection.prototype.handleInviteMessage=function(t){var e=null,n=t.getElementsByTagName("invite"),o=t.getElementsByTagName("reason")[0],r=o.textContent,i=t.getAttribute("id")||"";if(this.sendReceiptsMessage({id:i}),n&&n.length>0){var s=n[0].getAttribute("from");e=_parseNameFromJidFn(s)}var a=t.getElementsByTagName("x"),c=null;if(a&&a.length>0)for(var u=0;u<a.length;u++)if("jabber:x:conference"===a[u].namespaceURI){var l=a[u].getAttribute("jid");c=_parseNameFromJidFn(l)}this.onInviteMessage({type:"invite",from:e,roomid:c,reason:r})},connection.prototype.handleMutedMessage=function(t){var e=t.id;this.onMutedMessage({mid:e})},connection.prototype.sendCommand=function(t,e){this.isOpened()?this.context.stropheConn.send(t):(this.unSendMsgArr.push(t),this.offLineSendConnecting||this.logOut||(this.offLineSendConnecting=!0,this.reconnect()),this.onError({type:_code.WEBIM_CONNCTION_DISCONNECTED,reconnect:!0}))},connection.prototype.getUniqueId=function(t){this.autoIncrement?this.autoIncrement++:this.autoIncrement=1;var e=new Date,n=new Date(2010,1,1),o=e.getTime()-n.getTime(),r=parseFloat(o).toString(16)+this.autoIncrement;return"string"==typeof t||"number"==typeof t?t+"_"+r:"WEBIM_"+r},connection.prototype.send=function(t){var e=this,n=t;if("txt"===n.type)if("base64"===this.encrypt.type)n.msg=btoa(n.msg);else if("aes"===this.encrypt.type){var o=CryptoJS.enc.Utf8.parse(this.encrypt.key),r=CryptoJS.enc.Utf8.parse(this.encrypt.iv),i=this.encrypt.mode.toLowerCase(),s={};"cbc"===i?s={iv:r,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}:"ebc"===i&&(s={mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});var a=CryptoJS.AES.encrypt(n.msg,o,s);n.msg=a.toString()}if(this.isWindowSDK)WebIM.doQuery('{"type":"sendMessage","to":"'+n.to+'","message_type":"'+n.type+'","msg":"'+encodeURI(n.msg)+'","chatType":"'+n.chatType+'"}',function(t){},function(t,n){var o={data:{data:"send"},type:_code.WEBIM_MESSAGE_SED_ERROR};e.onError(o)});else if("[object Object]"===Object.prototype.toString.call(n)){var c=this.context.appKey||"",u=c+"_"+n.to+"@"+this.domain;n.group&&(u=c+"_"+n.to+"@conference."+this.domain),n.resource&&(u=u+"/"+n.resource),n.toJid=u,n.id=n.id||this.getUniqueId(),_msgHash[n.id]=new _message(n),_msgHash[n.id].send(this)}else"string"==typeof n&&_msgHash[n]&&_msgHash[n].send(this)},connection.prototype.addRoster=function(t){var e=_getJid(t,this),n=t.name||"",o=t.groups||"",r=$iq({type:"set"});if(r.c("query",{xmlns:"jabber:iq:roster"}),r.c("item",{jid:e,name:n}),o)for(var i=0;i<o.length;i++)r.c("group").t(o[i]).up();var s=t.success||_utils.emptyfn,a=t.error||_utils.emptyfn;this.context.stropheConn.sendIQ(r.tree(),s,a)},connection.prototype.removeRoster=function(t){var e=_getJid(t,this),n=$iq({type:"set"}).c("query",{xmlns:"jabber:iq:roster"}).c("item",{jid:e,subscription:"remove"}),o=t.success||_utils.emptyfn,r=t.error||_utils.emptyfn;this.context.stropheConn.sendIQ(n,o,r)},connection.prototype.getRoster=function(t){var e=$iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"}),t=t||{},n=t.success||this.onRoster,o=function(t){var e=[],o=t.getElementsByTagName("query");if(o&&o.length>0){var r=o[0];e=_parseFriend(r)}n(e,t)},r=t.error||this.onError,i=function(t){r({type:_code.WEBIM_CONNCTION_GETROSTER_ERROR,data:t})};this.isOpened()?this.context.stropheConn.sendIQ(e.tree(),o,i):r({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.subscribe=function(t){var e=_getJid(t,this),n=$pres({to:e,type:"subscribe"});t.message&&n.c("status").t(t.message).up(),t.nick&&n.c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(t.nick),this.sendCommand(n.tree())},connection.prototype.subscribed=function(t){var e=_getJid(t,this),n=$pres({to:e,type:"subscribed"});t.message&&n.c("status").t(t.message).up(),this.sendCommand(n.tree())},connection.prototype.unsubscribe=function(t){var e=_getJid(t,this),n=$pres({to:e,type:"unsubscribe"});t.message&&n.c("status").t(t.message),this.sendCommand(n.tree())},connection.prototype.unsubscribed=function(t){var e=_getJid(t,this),n=$pres({to:e,type:"unsubscribed"});t.message&&n.c("status").t(t.message).up(),this.sendCommand(n.tree())},connection.prototype.joinPublicGroup=function(t){var e=this.context.appKey+"_"+t.roomId+"@conference."+this.domain,n=e+"/"+this.context.userId,o=t.success||_utils.emptyfn,r=t.error||_utils.emptyfn,i=function(t){r({type:_code.WEBIM_CONNCTION_JOINROOM_ERROR,data:t})},s=$pres({from:this.context.jid,to:n}).c("x",{xmlns:Strophe.NS.MUC});this.context.stropheConn.sendIQ(s.tree(),o,i)},connection.prototype.listRooms=function(t){var e=$iq({to:t.server||"conference."+this.domain,from:this.context.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS}),n=t.success||_utils.emptyfn,o=t.error||this.onError,r=function(t){var e=[];e=_parseRoom(t);try{n(e)}catch(t){o({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:t})}},i=t.error||_utils.emptyfn,s=function(t){i({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:t})};this.context.stropheConn.sendIQ(e.tree(),r,s)},connection.prototype.queryRoomMember=function(t){var e=(this.domain,[]),n=$iq({to:this.context.appKey+"_"+t.roomId+"@conference."+this.domain,type:"get"}).c("query",{xmlns:Strophe.NS.MUC+"#admin"}).c("item",{affiliation:"member"}),o=t.success||_utils.emptyfn,r=function(t){var n=t.getElementsByTagName("item");if(n)for(var r=0;r<n.length;r++){var i=n[r],s={jid:i.getAttribute("jid"),affiliation:"member"};e.push(s)}o(e)},i=t.error||_utils.emptyfn,s=function(t){i({type:_code.WEBIM_CONNCTION_GETROOMMEMBER_ERROR,data:t})};this.context.stropheConn.sendIQ(n.tree(),r,s)},connection.prototype.queryRoomInfo=function(t){var e=this.domain,n=$iq({to:this.context.appKey+"_"+t.roomId+"@conference."+e,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_INFO}),o=t.success||_utils.emptyfn,r=[],i=function(t){var n="",i=t.getElementsByTagName("feature");switch(i&&(n=i[1].getAttribute("var")+"|"+i[3].getAttribute("var")+"|"+i[4].getAttribute("var")),n){case"muc_public|muc_membersonly|muc_notallowinvites":n="PUBLIC_JOIN_APPROVAL";break;case"muc_public|muc_open|muc_notallowinvites":n="PUBLIC_JOIN_OPEN";break;case"muc_hidden|muc_membersonly|muc_allowinvites":n="PRIVATE_MEMBER_INVITE";break;case"muc_hidden|muc_membersonly|muc_notallowinvites":n="PRIVATE_OWNER_INVITE"}var s=t.getElementsByTagName("field"),a={};if(s){for(var c=0;c<s.length;c++){var u=s[c],l=u.getAttribute("var"),p=l.split("_")[1];switch(l){case"muc#roominfo_occupants":case"muc#roominfo_maxusers":case"muc#roominfo_affiliations":case"muc#roominfo_description":a[p]=u.textContent||u.text||"";break;case"muc#roominfo_owner":var h={jid:(u.textContent||u.text)+"@"+e,affiliation:"owner"};r.push(h),a[p]=u.textContent||u.text}}a.name=t.getElementsByTagName("identity")[0].getAttribute("name")}o(n,r,a)},s=t.error||_utils.emptyfn,a=function(t){s({type:_code.WEBIM_CONNCTION_GETROOMINFO_ERROR,data:t})};this.context.stropheConn.sendIQ(n.tree(),i,a)},connection.prototype.queryRoomOccupants=function(t){var e=t.success||_utils.emptyfn,n=function(t){var n=[];n=_parseRoomOccupants(t),e(n)},o=t.error||_utils.emptyfn,r=function(t){o({type:_code.WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR,data:t})},i={xmlns:Strophe.NS.DISCO_ITEMS},s=$iq({from:this.context.jid,to:this.context.appKey+"_"+t.roomId+"@conference."+this.domain,type:"get"}).c("query",i);this.context.stropheConn.sendIQ(s.tree(),n,r)},connection.prototype.setUserSig=function(t){var e=$pres({xmlns:"jabber:client"});t=t||"",e.c("status").t(t),this.sendCommand(e.tree())},connection.prototype.setPresence=function(t,e){var n=$pres({xmlns:"jabber:client"});t&&(e?(n.c("show").t(t),n.up().c("status").t(e)):n.c("show").t(t)),this.sendCommand(n.tree())},connection.prototype.getPresence=function(){var t=$pres({xmlns:"jabber:client"});this.sendCommand(t.tree())},connection.prototype.ping=function(t){var t=t||{},e=_getJid(t,this),n=$iq({from:this.context.jid||"",to:e,type:"get"}).c("ping",{xmlns:"urn:xmpp:ping"}),o=t.success||_utils.emptyfn,r=t.error||this.onError,i=function(t){r({type:_code.WEBIM_CONNCTION_PING_ERROR,data:t})};this.isOpened()?this.context.stropheConn.sendIQ(n.tree(),o,i):r({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.isOpened=function(){return this.context.status==_code.STATUS_OPENED},connection.prototype.isOpening=function(){var t=this.context.status;return t==_code.STATUS_DOLOGIN_USERGRID||t==_code.STATUS_DOLOGIN_IM},connection.prototype.isClosing=function(){return this.context.status==_code.STATUS_CLOSING},connection.prototype.isClosed=function(){return this.context.status==_code.STATUS_CLOSED},connection.prototype.clear=function(){var t=this.context.appKey;if(this.errorType!=_code.WEBIM_CONNCTION_DISCONNECTED&&this.logOut&&(this.unSendMsgArr=[],this.offLineSendConnecting=!1,this.context={status:_code.STATUS_INIT,appKey:t}),this.intervalId&&clearInterval(this.intervalId),this.restIndex=0,this.xmppIndex=0,this.errorType==_code.WEBIM_CONNCTION_CLIENT_LOGOUT||-1==this.errorType){var e={data:{data:"logout"},type:_code.WEBIM_CONNCTION_CLIENT_LOGOUT};this.onError(e)}},connection.prototype.getChatRooms=function(t){if(!_utils.isCanSetRequestHeader)return void e.onError({type:_code.WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR});var e=this,n=t.accessToken||this.context.accessToken;if(n){var o=t.apiUrl,r=this.context.appName,i=this.context.orgName;if(!r||!i)return void e.onError({type:_code.WEBIM_CONNCTION_AUTH_ERROR});var s=function(e,n){"function"==typeof t.success&&t.success(e)},a=function(t,n,o){t.error&&t.error_description&&e.onError({type:_code.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR,msg:t.error_description,data:t,xhr:n})},c={pagenum:parseInt(t.pagenum)||1,pagesize:parseInt(t.pagesize)||20},u={url:o+"/"+i+"/"+r+"/chatrooms",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+n},data:c,success:s||_utils.emptyfn,error:a||_utils.emptyfn};_utils.ajax(u)}else e.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR})},connection.prototype.joinChatRoom=function(t){var e=this.context.appKey+"_"+t.roomId+"@conference."+this.domain,n=e+"/"+this.context.userId,o=t.success||_utils.emptyfn,r=t.error||_utils.emptyfn,i=function(t){r({type:_code.WEBIM_CONNCTION_JOINCHATROOM_ERROR,data:t})},s=$pres({from:this.context.jid,to:n}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"member",role:"participant"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(s.tree(),o,i)},connection.prototype.quitChatRoom=function(t){var e=this.context.appKey+"_"+t.roomId+"@conference."+this.domain,n=e+"/"+this.context.userId,o=t.success||_utils.emptyfn,r=t.error||_utils.emptyfn,i=function(t){r({type:_code.WEBIM_CONNCTION_QUITCHATROOM_ERROR,data:t})},s=$pres({from:this.context.jid,to:n,type:"unavailable"}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"none",role:"none"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(s.tree(),o,i)},connection.prototype._onReceiveInviteFromGroup=function(info){info=eval("("+info+")");var self=this,options={title:"Group invitation",msg:info.user+" invites you to join into group:"+info.group_id,agree:function(){WebIM.doQuery('{"type":"acceptInvitationFromGroup","id":"'+info.group_id+'","user":"'+info.user+'"}',function(t){},function(t,e){var n={data:{data:"acceptInvitationFromGroup error:"+e},type:_code.WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP};self.onError(n)})},reject:function(){WebIM.doQuery('{"type":"declineInvitationFromGroup","id":"'+info.group_id+'","user":"'+info.user+'"}',function(t){},function(t,e){var n={data:{data:"declineInvitationFromGroup error:"+e},type:_code.WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP};self.onError(n)})}};this.onConfirmPop(options)},connection.prototype._onReceiveInviteAcceptionFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation response",msg:info.user+" agreed to join into group:"+info.group_id,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveInviteDeclineFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation response",msg:info.user+" rejected to join into group:"+info.group_id,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onAutoAcceptInvitationFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation",msg:"You had joined into the group:"+info.group_name+" automatically.Inviter:"+info.user,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onLeaveGroup=function(info){info=eval("("+info+")");var options={title:"Group notification",msg:"You have been out of the group:"+info.group_id+".Reason:"+info.msg,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveJoinGroupApplication=function(info){info=eval("("+info+")");var self=this,options={title:"Group join application",msg:info.user+" applys to join into group:"+info.group_id,agree:function(){WebIM.doQuery('{"type":"acceptJoinGroupApplication","id":"'+info.group_id+'","user":"'+info.user+'"}',function(t){},function(t,e){var n={data:{data:"acceptJoinGroupApplication error:"+e},type:_code.WEBIM_CONNECTION_ACCEPT_JOIN_GROUP};self.onError(n)})},reject:function(){WebIM.doQuery('{"type":"declineJoinGroupApplication","id":"'+info.group_id+'","user":"'+info.user+'"}',function(t){},function(t,e){var n={data:{data:"declineJoinGroupApplication error:"+e},type:_code.WEBIM_CONNECTION_DECLINE_JOIN_GROUP};self.onError(n)})}};this.onConfirmPop(options)},connection.prototype._onReceiveAcceptionFromGroup=function(info){info=eval("("+info+")");var options={title:"Group notification",msg:"You had joined into the group:"+info.group_name+".",agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveRejectionFromGroup=function(){info=eval("("+info+")");var options={title:"Group notification",msg:"You have been rejected to join into the group:"+info.group_name+".",agree:function(){}};this.onConfirmPop(options)},connection.prototype._onUpdateMyGroupList=function(t){this.onUpdateMyGroupList(t)},connection.prototype._onUpdateMyRoster=function(t){this.onUpdateMyRoster(t)},connection.prototype.reconnect=function(){var t=this;setTimeout(function(){_login(t.context.restTokenData,t)},1e3*(0==this.autoReconnectNumTotal?0:this.autoReconnectInterval)),this.autoReconnectNumTotal++},connection.prototype.closed=function(){var t={data:{data:"Closed error"},type:_code.WEBIM_CONNECTION_CLOSED};this.onError(t)},connection.prototype.getBlacklist=function(t){t=t||{};var e=$iq({type:"get"}),n=t.success||_utils.emptyfn,o=t.error||_utils.emptyfn,r=this;e.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),this.context.stropheConn.sendIQ(e.tree(),function(t){r.onBlacklistUpdate(_parsePrivacy(t)),n()},function(){r.onBlacklistUpdate([]),o()})},connection.prototype.addToBlackList=function(t){for(var e=$iq({type:"set"}),n=t.list||{},o=t.type||"jid",r=t.success||_utils.emptyfn,i=t.error||_utils.emptyfn,s=e.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),a=Object.keys(n),c=a.length,u=2,l=0;l<c;l++){var p=n[a[l]],o=p.type||"jid",h=p.jid;s=s.c("item",{action:"deny",order:u++,type:o,value:h}).c("message"),l!==c-1&&(s=s.up().up())}this.context.stropheConn.sendIQ(s.tree(),r,i)},connection.prototype.removeFromBlackList=function(t){for(var e=$iq({type:"set"}),n=t.list||{},o=t.success||_utils.emptyfn,r=t.error||_utils.emptyfn,i=e.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),s=Object.keys(n),a=s.length,c=0;c<a;c++){var u=n[s[c]],l=u.type||"jid",p=u.jid,h=u.order;i=i.c("item",{action:"deny",order:h,type:l,value:p}).c("message"),c!==a-1&&(i=i.up().up())}this.context.stropheConn.sendIQ(i.tree(),o,r)},connection.prototype._getGroupJid=function(t){return(this.context.appKey||"")+"_"+t+"@conference."+this.domain},connection.prototype.addToGroupBlackList=function(t){var e=t.success||_utils.emptyfn,n=t.error||_utils.emptyfn,o=_getJid(t,this),r=this._getGroupJid(t.roomId),i=$iq({type:"set",to:r});i.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"outcast",jid:o}),this.context.stropheConn.sendIQ(i.tree(),e,n)},connection.prototype.getGroupBlacklist=function(t){var e=t.success||_utils.emptyfn,n=t.error||_utils.emptyfn,o=this._getGroupJid(t.roomId),r=$iq({type:"get",to:o});r.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"outcast"}),this.context.stropheConn.sendIQ(r.tree(),function(t){e(_parseGroupBlacklist(t))},function(){n()})},connection.prototype.removeGroupMemberFromBlacklist=function(t){var e=t.success||_utils.emptyfn,n=t.error||_utils.emptyfn,o=_getJid(t,this),r=this._getGroupJid(t.roomId),i=$iq({type:"set",to:r});i.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"none",jid:o}),this.context.stropheConn.sendIQ(i.tree(),function(t){e()},function(){n()})},connection.prototype.changeGroupSubject=function(t){var e=t.success||_utils.emptyfn,n=t.error||_utils.emptyfn,o=this._getGroupJid(t.roomId),r=$iq({type:"set",to:o});r.c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).c("x",{type:"submit",xmlns:"jabber:x:data"}).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up().c("field",{var:"muc#roomconfig_roomname"}).c("value").t(t.subject).up().up().c("field",{var:"muc#roomconfig_roomdesc"}).c("value").t(t.description),this.context.stropheConn.sendIQ(r.tree(),function(t){e()},function(){n()})},connection.prototype.destroyGroup=function(t){var e=t.success||_utils.emptyfn,n=t.error||_utils.emptyfn,o=this._getGroupJid(t.roomId),r=$iq({type:"set",to:o});r.c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).c("destroy").c("reason").t(t.reason||""),this.context.stropheConn.sendIQ(r.tree(),function(t){e()},function(){n()})},connection.prototype.leaveGroupBySelf=function(t){var e=this,n=t.success||_utils.emptyfn,o=t.error||_utils.emptyfn,r=_getJid(t,this),i=this._getGroupJid(t.roomId),s=$iq({type:"set",to:i});s.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"none",jid:r}),this.context.stropheConn.sendIQ(s.tree(),function(t){n(t);var o=$pres({type:"unavailable",to:i+"/"+e.context.userId});e.sendCommand(o.tree())},function(t){o(t)})},connection.prototype.leaveGroup=function(t){for(var e=t.success||_utils.emptyfn,n=t.error||_utils.emptyfn,o=t.list||[],r=this._getGroupJid(t.roomId),i=$iq({type:"set",to:r}),s=i.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}),a=Object.keys(o),c=a.length,u=0;u<c;u++){var l=o[a[u]],p=_getJidByName(l,this);s=s.c("item",{affiliation:"none",jid:p}).up().c("item",{role:"none",jid:p}).up()}this.context.stropheConn.sendIQ(i.tree(),function(t){e(t)},function(t){n(t)})},connection.prototype.addGroupMembers=function(t){for(var e=t.success||_utils.emptyfn,n=t.error||_utils.emptyfn,o=t.list||[],r=this._getGroupJid(t.roomId),i=$iq({type:"set",to:r}),s=i.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}),a=o.length,c=0;c<a;c++){var u=o[c],l=_getJidByName(u,this);s=s.c("item",{affiliation:"member",jid:l}).up();var p=$msg({to:r}).c("x",{xmlns:"http://jabber.org/protocol/muc#user"}).c("invite",{to:l}).c("reason").t(t.reason||"");this.sendCommand(p.tree())}this.context.stropheConn.sendIQ(i.tree(),function(t){e(t)},function(t){n(t)})},connection.prototype.acceptInviteFromGroup=function(t){t.success=function(){},this.addGroupMembers(t)},connection.prototype.rejectInviteFromGroup=function(t){},connection.prototype.createGroupAsync=function(t){var e=t.from,n=this,o=this._getGroupJid(e),r=(this.context.userId,this.groupOption),i=t.success||_utils.emptyfn,s=$iq({type:"get",to:o}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});n.context.stropheConn.sendIQ(s.tree(),function(t){if("setAttribute"in t){var s=t.getElementsByTagName("x")[0];s.setAttribute("type","submit")}else Strophe.forEachChild(t,"x",function(t){t.setAttribute("type","submit")});Strophe.info("step 5 ----------"),Strophe.forEachChild(s,"field",function(t){var e=t.getAttribute("var"),n=t.getElementsByTagName("value")[0];switch(Strophe.info(e),e){case"muc#roomconfig_maxusers":_setText(n,r.optionsMaxUsers||200);break;case"muc#roomconfig_roomname":_setText(n,r.subject||"");break;case"muc#roomconfig_roomdesc":_setText(n,r.description||"");break;case"muc#roomconfig_publicroom":_setText(n,+r.optionsPublic);break;case"muc#roomconfig_membersonly":_setText(n,+r.optionsMembersOnly);break;case"muc#roomconfig_moderatedroom":_setText(n,+r.optionsModerate);break;case"muc#roomconfig_persistentroom":_setText(n,1);break;case"muc#roomconfig_allowinvites":_setText(n,+r.optionsAllowInvites);break;case"muc#roomconfig_allowvisitornickchange":case"muc#roomconfig_allowvisitorstatus":case"allow_private_messages":_setText(n,0);break;case"allow_private_messages_from_visitors":_setText(n,"nobody")}});var a=$iq({to:o,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).cnode(s);n.context.stropheConn.sendIQ(a.tree(),function(t){n.addGroupMembers({list:r.members,roomId:e}),i(r)},function(t){})},function(t){})},connection.prototype.createGroup=function(t){this.groupOption=t;var e=+new Date,n=this._getGroupJid(e),o=n+"/"+this.context.userId,r=$pres({to:o}).c("x",{xmlns:"http://jabber.org/protocol/muc"}).up().c("create",{xmlns:"http://jabber.org/protocol/muc"}).up();this.sendCommand(r.tree())},connection.prototype.createGroupNew=function(t){t.data.owner=this.user;var e={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups",dataType:"json",type:"POST",data:JSON.stringify(t.data),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};e.success=function(e){t.success(e),this.onCreateGroup(e)}.bind(this),e.error=t.error||_utils.emptyfn,WebIM.utils.ajax(e)},connection.prototype.blockGroup=function(t){var e=t.groupId;e="notification_ignore_"+e;var n={entities:[]};n.entities[0]={},n.entities[0][e]=!0;var o={type:"PUT",url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/users/"+this.user,data:JSON.stringify(n),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=t.success||_utils.emptyfn,o.error=t.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.joinGroup=function(t){var e={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t.groupId+"/apply",type:"POST",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};e.success=t.success||_utils.emptyfn,e.error=t.error||_utils.emptyfn,WebIM.utils.ajax(e)},connection.prototype.listGroups=function(t){var e=[];if(e.limit=t.limit,e.cursor=t.cursor,e.cursor||delete e.cursor,isNaN(t.limit))throw'The parameter "limit" should be a number';var n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/publicchatgroups",type:"GET",dataType:"json",data:e,headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=t.success||_utils.emptyfn,n.error=t.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.getGroupInfo=function(t){var e={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t.groupId,type:"GET",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};e.success=t.success||_utils.emptyfn,e.error=t.error||_utils.emptyfn,WebIM.utils.ajax(e)},connection.prototype.getGroup=function(t){var e={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/users/"+this.user+"/joined_chatgroups",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};e.success=t.success||_utils.emptyfn,e.error=t.error||_utils.emptyfn,WebIM.utils.ajax(e)},connection.prototype.listGroupMember=function(t){if(isNaN(t.pageNum)||t.pageNum<=0)throw'The parameter "pageNum" should be a positive number';if(isNaN(t.pageSize)||t.pageSize<=0)throw'The parameter "pageSize" should be a positive number';if(null===t.groupId&&void 0===t.groupId)throw'The parameter "groupId" should be added';var e=[],n=t.groupId;e.pagenum=t.pageNum,e.pagesize=t.pageSize;var o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+n+"/users",dataType:"json",type:"GET",data:e,headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=t.success||_utils.emptyfn,o.error=t.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.mute=function(t){var e=t.groupId,n={usernames:[t.username],mute_duration:t.muteDuration},o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/mute",dataType:"json",type:"POST",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"},data:JSON.stringify(n)};o.success=t.success||_utils.emptyfn,o.error=t.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.removeMute=function(t){var e=t.groupId,n=t.username,o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/mute/"+n,dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=t.success||_utils.emptyfn,o.error=t.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.getGroupAdmin=function(t){var e=t.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/admin",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=t.success||_utils.emptyfn,n.error=t.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.getMuted=function(t){var e=t.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/mute",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=t.success||_utils.emptyfn,n.error=t.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.setAdmin=function(t){var e=t.groupId,n={newadmin:t.username},o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/admin",type:"POST",dataType:"json",data:JSON.stringify(n),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=t.success||_utils.emptyfn,o.error=t.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.removeAdmin=function(t){var e=t.groupId,n=t.username,o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/admin/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=t.success||_utils.emptyfn,o.error=t.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.agreeJoinGroup=function(t){var e=t.groupId,n={applicant:t.applicant,verifyResult:!0,reason:"no clue"},o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/apply_verify",type:"POST",dataType:"json",data:JSON.stringify(n),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=t.success||_utils.emptyfn,o.error=t.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.rejectJoinGroup=function(t){var e=t.groupId,n={applicant:t.applicant,verifyResult:!1,reason:"no clue"},o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/apply_verify",type:"POST",dataType:"json",data:JSON.stringify(n),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=t.success||_utils.emptyfn,o.error=t.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.groupBlockSingle=function(t){var e=t.groupId,n=t.username,o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/blocks/users/"+n,type:"POST",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=t.success||_utils.emptyfn,o.error=t.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.groupBlockMulti=function(t){var e=t.groupId,n=t.usernames,o={usernames:n},r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/blocks/users",data:JSON.stringify(o),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.removeGroupBlockSingle=function(t){var e=t.groupId,n=t.username,o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/blocks/users/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=t.success||_utils.emptyfn,o.error=t.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.removeGroupBlockMulti=function(t){var e=t.groupId,n=t.username.join(","),o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/blocks/users/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=t.success||_utils.emptyfn,o.error=t.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.dissolveGroup=function(t){var e=t.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"?version=v3",type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=t.success||_utils.emptyfn,n.error=t.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.getGroupBlacklistNew=function(t){var e=t.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/blocks/users",type:"GET",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=t.success||_utils.emptyfn,n.error=t.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.quitGroup=function(t){var e=t.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/quit",type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=t.success||_utils.emptyfn,n.error=t.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.modifyGroup=function(t){var e=t.groupId,n={groupname:t.groupName,description:t.description},o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e,type:"PUT",data:JSON.stringify(n),dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=t.success||_utils.emptyfn,o.error=t.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.removeSingleGroupMember=function(t){var e=t.groupId,n=t.username,o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/users/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=t.success||_utils.emptyfn,o.error=t.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.removeMultiGroupMember=function(t){var e=t.groupId,n=t.users.join(","),o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/users/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=t.success||_utils.emptyfn,o.error=t.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.inviteToGroup=function(t){var e=t.groupId,n=t.users,o={usernames:n},r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/invite",type:"POST",data:JSON.stringify(o),dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)};var WebIM=window.WebIM||{};WebIM.connection=connection,WebIM.utils=_utils,WebIM.statusCode=_code,WebIM.message=_msg.message,WebIM.doQuery=function(t,e,n){void 0!==window.cefQuery&&window.cefQuery({request:t,persistent:!1,onSuccess:e,onFailure:n})},WebIM.debug=function(t){logMessage=function(e){t&&console.log(WebIM.utils.ts()+"[recv] ",e.data)},Strophe.Connection.prototype.rawOutput=function(e){t&&console.log("%c "+WebIM.utils.ts()+"[send] "+e,"background-color: #e2f7da")}},module.exports=WebIM},function(t,e,n){"use strict";n(12);!function(){var t=n(11).utils,o=function t(e,n){return!this instanceof t?new t(e):(this._msg={},"function"==typeof t[e]&&(t[e].prototype.setGroup=this.setGroup,this._msg=new t[e](n)),this._msg)};o.prototype.setGroup=function(t){this.body.group=t},o.read=function(t){this.id=t,this.type="read"},o.read.prototype.set=function(t){this.body={ackId:t.id,to:t.to}},o.delivery=function(t){this.id=t,this.type="delivery"},o.delivery.prototype.set=function(t){this.body={bodyId:t.id,to:t.to}},o.txt=function(t){this.id=t,this.type="txt",this.body={}},o.txt.prototype.set=function(t){this.value=t.msg,this.body={id:this.id,to:t.to,msg:this.value,type:this.type,roomType:t.roomType,ext:t.ext||{},success:t.success,fail:t.fail},!t.roomType&&delete this.body.roomType},o.cmd=function(t){this.id=t,this.type="cmd",this.body={}},o.cmd.prototype.set=function(t){this.value="",this.body={to:t.to,action:t.action,msg:this.value,type:this.type,roomType:t.roomType,ext:t.ext||{},success:t.success},!t.roomType&&delete this.body.roomType},o.location=function(t){this.id=t,this.type="loc",this.body={}},o.location.prototype.set=function(t){this.body={to:t.to,type:this.type,roomType:t.roomType,addr:t.addr,lat:t.lat,lng:t.lng,ext:t.ext||{}}},o.img=function(t){this.id=t,this.type="img",this.body={}},o.img.prototype.set=function(e){e.file=e.file||t.getFileUrl(e.fileInputId),this.value=e.file,this.body={id:this.id,file:this.value,apiUrl:e.apiUrl,to:e.to,type:this.type,ext:e.ext||{},roomType:e.roomType,onFileUploadError:e.onFileUploadError,onFileUploadComplete:e.onFileUploadComplete,success:e.success,fail:e.fail,flashUpload:e.flashUpload,width:e.width,height:e.height,body:e.body,uploadError:e.uploadError,uploadComplete:e.uploadComplete},!e.roomType&&delete this.body.roomType},o.audio=function(t){this.id=t,this.type="audio",this.body={}},o.audio.prototype.set=function(e){e.file=e.file||t.getFileUrl(e.fileInputId),this.value=e.file,this.filename=e.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:e.apiUrl,to:e.to,type:this.type,ext:e.ext||{},length:e.length||0,roomType:e.roomType,file_length:e.file_length,onFileUploadError:e.onFileUploadError,onFileUploadComplete:e.onFileUploadComplete,success:e.success,fail:e.fail,flashUpload:e.flashUpload,body:e.body},!e.roomType&&delete this.body.roomType},o.file=function(t){this.id=t,this.type="file",this.body={}},o.file.prototype.set=function(e){e.file=e.file||t.getFileUrl(e.fileInputId),this.value=e.file,this.filename=e.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:e.apiUrl,to:e.to,type:this.type,ext:e.ext||{},roomType:e.roomType,onFileUploadError:e.onFileUploadError,onFileUploadComplete:e.onFileUploadComplete,success:e.success,fail:e.fail,flashUpload:e.flashUpload,body:e.body},!e.roomType&&delete this.body.roomType},o.video=function(t){},o.video.prototype.set=function(t){};var r=function t(e){if(!this instanceof t)return new t(e,conn);this.msg=e};r.prototype.send=function(e){var n=this,o=function(n){n.ext=n.ext||{},n.ext.weichat=n.ext.weichat||{},n.ext.weichat.originType=n.ext.weichat.originType||"webim";var o,r={from:e.context.userId||"",to:n.to,bodies:[n.body],ext:n.ext||{}},i=t.stringify(r);if(o=$msg({type:n.group||"chat",to:n.toJid,id:n.id,xmlns:"jabber:client"}).c("body").t(i),n.roomType&&o.up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"}),n.bodyId){o=$msg({from:e.context.jid||"",to:n.toJid,id:n.id,xmlns:"jabber:client"}).c("body").t(n.bodyId);var s={xmlns:"urn:xmpp:receipts",id:n.bodyId};o.up().c("delivery",s)}if(n.ackId){if(e.context.jid.indexOf(n.toJid)>=0)return;o=$msg({from:e.context.jid||"",to:n.toJid,id:n.id,xmlns:"jabber:client"}).c("body").t(n.ackId);var a={xmlns:"urn:xmpp:receipts",id:n.ackId};o.up().c("acked",a)}setTimeout(function(){"undefined"!=typeof _msgHash&&_msgHash[n.id]&&_msgHash[n.id].msg.fail instanceof Function&&_msgHash[n.id].msg.fail(n.id)},6e4),e.sendCommand(o.tree(),n.id)};if(n.msg.file){if(n.msg.body&&n.msg.body.url)return void o(n.msg);var r=n.msg.onFileUploadComplete,i=function(t){if(t.entities[0]["file-metadata"]){var i=t.entities[0]["file-metadata"]["content-length"];n.msg.filetype=t.entities[0]["file-metadata"]["content-type"],i>204800&&(n.msg.thumbnail=!0)}n.msg.body={type:n.msg.type||"file",url:("https:"!=location.protocol&&e.isHttpDNS?e.apiUrl+t.uri.substr(t.uri.indexOf("/",9)):t.uri)+"/"+t.entities[0].uuid,secret:t.entities[0]["share-secret"],filename:n.msg.file.filename||n.msg.filename,size:{width:n.msg.width||0,height:n.msg.height||0},length:n.msg.length||0,file_length:n.msg.ext.file_length||0,filetype:n.msg.filetype},o(n.msg),r instanceof Function&&r(t,n.msg.id)};n.msg.onFileUploadComplete=i,t.uploadFile.call(e,n.msg)}else n.msg.body={type:"chat"===n.msg.type?"txt":n.msg.type,msg:n.msg.msg},"cmd"===n.msg.type?n.msg.body.action=n.msg.action:"loc"===n.msg.type&&(n.msg.body.addr=n.msg.addr,n.msg.body.lat=n.msg.lat,n.msg.body.lng=n.msg.lng),o(n.msg)},e._msg=r,e.message=o}()},function(t,e,n){"use strict";!function(){function t(t){this.array=void 0===t?[]:new Array(t)}t.prototype={length:function(){return this.array.length},at:function(t){return this.array[t]},set:function(t,e){this.array[t]=e},push:function(t){return this.array.push(t)},slice:function(t,e){return this.array=this.array.slice(t,e)},concat:function(t){this.array=this.array.concat(t)},remove:function(t,e){e=void 0===e?1:e,this.array.splice(t,e)},join:function(t){return this.array.join(t)},clear:function(){this.array.length=0}};var n=function(){this._array_h=new t};n.prototype={_index:0,push:function(t){this._array_h.push(t)},pop:function(){var t=null;return this._array_h.length()&&(t=this._array_h.at(this._index),2*++this._index>=this._array_h.length()&&(this._array_h.slice(this._index),this._index=0)),t},head:function(){var t=null,e=this._array_h.length();return e&&(t=this._array_h.at(e-1)),t},tail:function(){var t=null;return this._array_h.length()&&(t=this._array_h.at(this._index)),t},length:function(){return this._array_h.length()-this._index},empty:function(){return 0===this._array_h.length()},clear:function(){this._array_h.clear()}},e.Queue=n}()},function(t,e,n){"use strict";var o,r,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(n,s){r=[],o=s,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i)}(0,function(){/**
     * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
     * Released under MIT license, http://github.com/requirejs/almond/LICENSE
     */
var t,e,n;return function(o){function r(t,e){return N.call(t,e)}function i(t,e){var n,o,r,i,s,a,c,u,l,p,h,d,f=e&&e.split("/"),m=b.map,y=m&&m["*"]||{};if(t){for(t=t.split("/"),s=t.length-1,b.nodeIdCompat&&T.test(t[s])&&(t[s]=t[s].replace(T,"")),"."===t[0].charAt(0)&&f&&(d=f.slice(0,f.length-1),t=d.concat(t)),l=0;l<t.length;l++)if("."===(h=t[l]))t.splice(l,1),l-=1;else if(".."===h){if(0===l||1===l&&".."===t[2]||".."===t[l-1])continue;l>0&&(t.splice(l-1,2),l-=2)}t=t.join("/")}if((f||y)&&m){for(n=t.split("/"),l=n.length;l>0;l-=1){if(o=n.slice(0,l).join("/"),f)for(p=f.length;p>0;p-=1)if((r=m[f.slice(0,p).join("/")])&&(r=r[o])){i=r,a=l;break}if(i)break;!c&&y&&y[o]&&(c=y[o],u=l)}!i&&c&&(i=c,a=u),i&&(n.splice(0,a,i),t=n.join("/"))}return t}function a(t,e){return function(){var n=E.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),m.apply(o,n.concat([t,e]))}}function c(t){return function(e){return i(e,t)}}function u(t){return function(e){g[t]=e}}function l(t){if(r(v,t)){var e=v[t];delete v[t],S[t]=!0,f.apply(o,e)}if(!r(g,t)&&!r(S,t))throw new Error("No "+t);return g[t]}function p(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function h(t){return t?p(t):[]}function d(t){return function(){return b&&b.config&&b.config[t]||{}}}var f,m,y,_,g={},v={},b={},S={},N=Object.prototype.hasOwnProperty,E=[].slice,T=/\.js$/;y=function(t,e){var n,o=p(t),r=o[0],s=e[1];return t=o[1],r&&(r=i(r,s),n=l(r)),r?t=n&&n.normalize?n.normalize(t,c(s)):i(t,s):(t=i(t,s),o=p(t),r=o[0],t=o[1],r&&(n=l(r))),{f:r?r+"!"+t:t,n:t,pr:r,p:n}},_={require:function(t){return a(t)},exports:function(t){var e=g[t];return void 0!==e?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:d(t)}}},f=function(t,e,n,i){var c,p,d,f,m,b,N,E=[],T=void 0===n?"undefined":s(n);if(i=i||t,b=h(i),"undefined"===T||"function"===T){for(e=!e.length&&n.length?["require","exports","module"]:e,m=0;m<e.length;m+=1)if(f=y(e[m],b),"require"===(p=f.f))E[m]=_.require(t);else if("exports"===p)E[m]=_.exports(t),N=!0;else if("module"===p)c=E[m]=_.module(t);else if(r(g,p)||r(v,p)||r(S,p))E[m]=l(p);else{if(!f.p)throw new Error(t+" missing "+p);f.p.load(f.n,a(i,!0),u(p),{}),E[m]=g[p]}d=n?n.apply(g[t],E):void 0,t&&(c&&c.exports!==o&&c.exports!==g[t]?g[t]=c.exports:d===o&&N||(g[t]=d))}else t&&(g[t]=n)},t=e=m=function(t,e,n,r,i){if("string"==typeof t)return _[t]?_[t](e):l(y(t,h(e)).f);if(!t.splice){if(b=t,b.deps&&m(b.deps,b.callback),!e)return;e.splice?(t=e,e=n,n=null):t=o}return e=e||function(){},"function"==typeof n&&(n=r,r=i),r?f(o,t,e,n):setTimeout(function(){f(o,t,e,n)},4),m},m.config=function(t){return m(t)},t._defined=g,n=function(t,e,n){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");e.splice||(n=e,e=[]),r(g,t)||r(v,t)||(v[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("node_modules/almond/almond.js",function(){}),function(t,e){if("function"!=typeof n||!n.amd)return e(t);n("strophe-polyfill",[],function(){return e(t)})}(this,function(t){Function.prototype.bind||(Function.prototype.bind=function(t){var e=this,n=Array.prototype.slice,o=Array.prototype.concat,r=n.call(arguments,1);return function(){return e.apply(t||this,o.call(r,n.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length,n=Number(arguments[1])||0;for(n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=e);n<e;n++)if(n in this&&this[n]===t)return n;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n,o;if(null===this)throw new TypeError(" this is null or not defined");var r=Object(this),i=r.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=e),o=0;o<i;){var s;o in r&&(s=r[o],t.call(n,s,o,r)),o++}});var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.btoa||(t.btoa=function(t){var n,o,r,i,s,a,c,u="",l=0;do{n=t.charCodeAt(l++),o=t.charCodeAt(l++),r=t.charCodeAt(l++),i=n>>2,s=(3&n)<<4|o>>4,a=(15&o)<<2|r>>6,c=63&r,isNaN(o)?(s=(3&n)<<4,a=c=64):isNaN(r)&&(c=64),u=u+e.charAt(i)+e.charAt(s)+e.charAt(a)+e.charAt(c)}while(l<t.length);return u}),t.atob||(t.atob=function(t){var n,o,r,i,s,a,c,u="",l=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{i=e.indexOf(t.charAt(l++)),s=e.indexOf(t.charAt(l++)),a=e.indexOf(t.charAt(l++)),c=e.indexOf(t.charAt(l++)),n=i<<2|s>>4,o=(15&s)<<4|a>>2,r=(3&a)<<6|c,u+=String.fromCharCode(n),64!==a&&(u+=String.fromCharCode(o)),64!==c&&(u+=String.fromCharCode(r))}while(l<t.length);return u})}),function(t,e){"function"==typeof n&&n.amd?n("strophe-sha1",[],function(){return e()}):t.SHA1=e()}(this,function(){function t(t,o){t[o>>5]|=128<<24-o%32,t[15+(o+64>>9<<4)]=o;var s,a,c,u,l,p,h,d,f=new Array(80),m=1732584193,y=-271733879,_=-1732584194,g=271733878,v=-1009589776;for(s=0;s<t.length;s+=16){for(u=m,l=y,p=_,h=g,d=v,a=0;a<80;a++)f[a]=a<16?t[s+a]:i(f[a-3]^f[a-8]^f[a-14]^f[a-16],1),c=r(r(i(m,5),e(a,y,_,g)),r(r(v,f[a]),n(a))),v=g,g=_,_=i(y,30),y=m,m=c;m=r(m,u),y=r(y,l),_=r(_,p),g=r(g,h),v=r(v,d)}return[m,y,_,g,v]}function e(t,e,n,o){return t<20?e&n|~e&o:t<40?e^n^o:t<60?e&n|e&o|n&o:e^n^o}function n(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function o(e,n){var o=s(e);o.length>16&&(o=t(o,8*e.length));for(var r=new Array(16),i=new Array(16),a=0;a<16;a++)r[a]=909522486^o[a],i[a]=1549556828^o[a];var c=t(r.concat(s(n)),512+8*n.length);return t(i.concat(c),672)}function r(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function i(t,e){return t<<e|t>>>32-e}function s(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<24-n%32;return e}function a(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>24-n%32&255);return e}function c(t){for(var e,n,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",i=0;i<4*t.length;i+=3)for(e=(t[i>>2]>>8*(3-i%4)&255)<<16|(t[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|t[i+2>>2]>>8*(3-(i+2)%4)&255,n=0;n<4;n++)8*i+6*n>32*t.length?r+="=":r+=o.charAt(e>>6*(3-n)&63);return r}return{b64_hmac_sha1:function(t,e){return c(o(t,e))},b64_sha1:function(e){return c(t(s(e),8*e.length))},binb2str:a,core_hmac_sha1:o,str_hmac_sha1:function(t,e){return a(o(t,e))},str_sha1:function(e){return a(t(s(e),8*e.length))}}}),function(t,e){"function"==typeof n&&n.amd?n("strophe-md5",[],function(){return e()}):t.MD5=e()}(this,function(){var t=function(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n},e=function(t,e){return t<<e|t>>>32-e},n=function(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e},o=function(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e},r=function(t){for(var e="0123456789abcdef",n="",o=0;o<4*t.length;o++)n+=e.charAt(t[o>>2]>>o%4*8+4&15)+e.charAt(t[o>>2]>>o%4*8&15);return n},i=function(n,o,r,i,s,a){return t(e(t(t(o,n),t(i,a)),s),r)},s=function(t,e,n,o,r,s,a){return i(e&n|~e&o,t,e,r,s,a)},a=function(t,e,n,o,r,s,a){return i(e&o|n&~o,t,e,r,s,a)},c=function(t,e,n,o,r,s,a){return i(e^n^o,t,e,r,s,a)},u=function(t,e,n,o,r,s,a){return i(n^(e|~o),t,e,r,s,a)},l=function(e,n){e[n>>5]|=128<<n%32,e[14+(n+64>>>9<<4)]=n;for(var o,r,i,l,p=1732584193,h=-271733879,d=-1732584194,f=271733878,m=0;m<e.length;m+=16)o=p,r=h,i=d,l=f,p=s(p,h,d,f,e[m+0],7,-680876936),f=s(f,p,h,d,e[m+1],12,-389564586),d=s(d,f,p,h,e[m+2],17,606105819),h=s(h,d,f,p,e[m+3],22,-1044525330),p=s(p,h,d,f,e[m+4],7,-176418897),f=s(f,p,h,d,e[m+5],12,1200080426),d=s(d,f,p,h,e[m+6],17,-1473231341),h=s(h,d,f,p,e[m+7],22,-45705983),p=s(p,h,d,f,e[m+8],7,1770035416),f=s(f,p,h,d,e[m+9],12,-1958414417),d=s(d,f,p,h,e[m+10],17,-42063),h=s(h,d,f,p,e[m+11],22,-1990404162),p=s(p,h,d,f,e[m+12],7,1804603682),f=s(f,p,h,d,e[m+13],12,-40341101),d=s(d,f,p,h,e[m+14],17,-1502002290),h=s(h,d,f,p,e[m+15],22,1236535329),p=a(p,h,d,f,e[m+1],5,-165796510),f=a(f,p,h,d,e[m+6],9,-1069501632),d=a(d,f,p,h,e[m+11],14,643717713),h=a(h,d,f,p,e[m+0],20,-373897302),p=a(p,h,d,f,e[m+5],5,-701558691),f=a(f,p,h,d,e[m+10],9,38016083),d=a(d,f,p,h,e[m+15],14,-660478335),h=a(h,d,f,p,e[m+4],20,-405537848),p=a(p,h,d,f,e[m+9],5,568446438),f=a(f,p,h,d,e[m+14],9,-1019803690),d=a(d,f,p,h,e[m+3],14,-187363961),h=a(h,d,f,p,e[m+8],20,1163531501),p=a(p,h,d,f,e[m+13],5,-1444681467),f=a(f,p,h,d,e[m+2],9,-51403784),d=a(d,f,p,h,e[m+7],14,1735328473),h=a(h,d,f,p,e[m+12],20,-1926607734),p=c(p,h,d,f,e[m+5],4,-378558),f=c(f,p,h,d,e[m+8],11,-2022574463),d=c(d,f,p,h,e[m+11],16,1839030562),h=c(h,d,f,p,e[m+14],23,-35309556),p=c(p,h,d,f,e[m+1],4,-1530992060),f=c(f,p,h,d,e[m+4],11,1272893353),d=c(d,f,p,h,e[m+7],16,-155497632),h=c(h,d,f,p,e[m+10],23,-1094730640),p=c(p,h,d,f,e[m+13],4,681279174),f=c(f,p,h,d,e[m+0],11,-358537222),d=c(d,f,p,h,e[m+3],16,-722521979),h=c(h,d,f,p,e[m+6],23,76029189),p=c(p,h,d,f,e[m+9],4,-640364487),f=c(f,p,h,d,e[m+12],11,-421815835),d=c(d,f,p,h,e[m+15],16,530742520),h=c(h,d,f,p,e[m+2],23,-995338651),p=u(p,h,d,f,e[m+0],6,-198630844),f=u(f,p,h,d,e[m+7],10,1126891415),d=u(d,f,p,h,e[m+14],15,-1416354905),h=u(h,d,f,p,e[m+5],21,-57434055),p=u(p,h,d,f,e[m+12],6,1700485571),f=u(f,p,h,d,e[m+3],10,-1894986606),d=u(d,f,p,h,e[m+10],15,-1051523),h=u(h,d,f,p,e[m+1],21,-2054922799),p=u(p,h,d,f,e[m+8],6,1873313359),f=u(f,p,h,d,e[m+15],10,-30611744),d=u(d,f,p,h,e[m+6],15,-1560198380),h=u(h,d,f,p,e[m+13],21,1309151649),p=u(p,h,d,f,e[m+4],6,-145523070),f=u(f,p,h,d,e[m+11],10,-1120210379),d=u(d,f,p,h,e[m+2],15,718787259),h=u(h,d,f,p,e[m+9],21,-343485551),p=t(p,o),h=t(h,r),d=t(d,i),f=t(f,l);return[p,h,d,f]};return{hexdigest:function(t){return r(l(n(t),8*t.length))},hash:function(t){return o(l(n(t),8*t.length))}}}),function(t,e){"function"==typeof n&&n.amd?n("strophe-utils",[],function(){return e()}):t.stropheUtils=e()}(this,function(){return{utf16to8:function(t){var e,n,o="",r=t.length;for(e=0;e<r;e++)n=t.charCodeAt(e),n>=0&&n<=127?o+=t.charAt(e):n>2047?(o+=String.fromCharCode(224|n>>12&15),o+=String.fromCharCode(128|n>>6&63),o+=String.fromCharCode(128|n>>0&63)):(o+=String.fromCharCode(192|n>>6&31),o+=String.fromCharCode(128|n>>0&63));return o},addCookies:function(t){var e,n,o,r,i,a,c;for(e in t||{})i="",a="",c="",n=t[e],o="object"===(void 0===n?"undefined":s(n)),r=escape(unescape(o?n.value:n)),o&&(i=n.expires?";expires="+n.expires:"",a=n.domain?";domain="+n.domain:"",c=n.path?";path="+n.path:""),document.cookie=e+"="+r+i+a+c}}}),function(t,e){if("function"==typeof n&&n.amd)n("strophe-core",["strophe-sha1","strophe-md5","strophe-utils"],function(){return e.apply(this,arguments)});else{var o=e(t.SHA1,t.MD5,t.stropheUtils);t.Strophe=o.Strophe,t.$build=o.$build,t.$iq=o.$iq,t.$msg=o.$msg,t.$pres=o.$pres,t.SHA1=o.SHA1,t.MD5=o.MD5,t.b64_hmac_sha1=o.SHA1.b64_hmac_sha1,t.b64_sha1=o.SHA1.b64_sha1,t.str_hmac_sha1=o.SHA1.str_hmac_sha1,t.str_sha1=o.SHA1.str_sha1}}(this,function(t,e,n){function o(t,e){return new c.Builder(t,e)}function r(t){return new c.Builder("message",t)}function i(t){return new c.Builder("iq",t)}function a(t){return new c.Builder("presence",t)}var c;return c={VERSION:"1.2.14",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(t){for(var e=0;e<c.XHTML.tags.length;e++)if(t===c.XHTML.tags[e])return!0;return!1},validAttribute:function(t,e){if(void 0!==c.XHTML.attributes[t]&&c.XHTML.attributes[t].length>0)for(var n=0;n<c.XHTML.attributes[t].length;n++)if(e===c.XHTML.attributes[t][n])return!0;return!1},validCSS:function(t){for(var e=0;e<c.XHTML.css.length;e++)if(t===c.XHTML.css[e])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(t,e){c.NS[t]=e},forEachChild:function(t,e,n){var o,r;for(o=0;o<t.childNodes.length;o++)r=t.childNodes[o],r.nodeType!==c.ElementType.NORMAL||e&&!this.isTagEqual(r,e)||n(r)},isTagEqual:function(t,e){return t.tagName===e},_xmlGenerator:null,_makeGenerator:function(){var t;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(t=this._getIEXmlDom(),t.appendChild(t.createElement("strophe"))):t=document.implementation.createDocument("jabber:client","strophe",null),t},xmlGenerator:function(){return c._xmlGenerator||(c._xmlGenerator=c._makeGenerator()),c._xmlGenerator},_getIEXmlDom:function(){for(var t=null,e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<e.length&&null===t;n++)try{t=new ActiveXObject(e[n])}catch(e){t=null}return t},xmlElement:function(t){if(!t)return null;var e,n,o,r=c.xmlGenerator().createElement(t);for(e=1;e<arguments.length;e++){var i=arguments[e];if(i)if("string"==typeof i||"number"==typeof i)r.appendChild(c.xmlTextNode(i));else if("object"===(void 0===i?"undefined":s(i))&&"function"==typeof i.sort)for(n=0;n<i.length;n++){var a=i[n];"object"===(void 0===a?"undefined":s(a))&&"function"==typeof a.sort&&void 0!==a[1]&&null!==a[1]&&r.setAttribute(a[0],a[1])}else if("object"===(void 0===i?"undefined":s(i)))for(o in i)i.hasOwnProperty(o)&&void 0!==i[o]&&null!==i[o]&&r.setAttribute(o,i[o])}return r},xmlescape:function(t){return t=t.replace(/\&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/'/g,"&apos;"),t=t.replace(/"/g,"&quot;")},xmlunescape:function(t){return t=t.replace(/\&amp;/g,"&"),t=t.replace(/&lt;/g,"<"),t=t.replace(/&gt;/g,">"),t=t.replace(/&apos;/g,"'"),t=t.replace(/&quot;/g,'"')},xmlTextNode:function(t){return c.xmlGenerator().createTextNode(t)},xmlHtmlNode:function(t){var e;if(DOMParser){e=(new DOMParser).parseFromString(t,"text/xml")}else e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t);return e},getText:function(t){if(!t)return null;var e="";0===t.childNodes.length&&t.nodeType===c.ElementType.TEXT&&(e+=t.nodeValue);for(var n=0;n<t.childNodes.length;n++)t.childNodes[n].nodeType===c.ElementType.TEXT&&(e+=t.childNodes[n].nodeValue);return c.xmlescape(e)},copyElement:function(t){var e,n;if(t.nodeType===c.ElementType.NORMAL){for(n=c.xmlElement(t.tagName),e=0;e<t.attributes.length;e++)n.setAttribute(t.attributes[e].nodeName,t.attributes[e].value);for(e=0;e<t.childNodes.length;e++)n.appendChild(c.copyElement(t.childNodes[e]))}else t.nodeType===c.ElementType.TEXT&&(n=c.xmlGenerator().createTextNode(t.nodeValue));return n},createHtml:function(t){var e,n,o,r,i,a,u,l,p,h,d;if(t.nodeType===c.ElementType.NORMAL)if(r=t.nodeName.toLowerCase(),c.XHTML.validTag(r))try{for(n=c.xmlElement(r),e=0;e<c.XHTML.attributes[r].length;e++)if(i=c.XHTML.attributes[r][e],void 0!==(a=t.getAttribute(i))&&null!==a&&""!==a&&!1!==a&&0!==a)if("style"===i&&"object"===(void 0===a?"undefined":s(a))&&void 0!==a.cssText&&(a=a.cssText),"style"===i){for(u=[],l=a.split(";"),o=0;o<l.length;o++)p=l[o].split(":"),h=p[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),c.XHTML.validCSS(h)&&(d=p[1].replace(/^\s*/,"").replace(/\s*$/,""),u.push(h+": "+d));u.length>0&&(a=u.join("; "),n.setAttribute(i,a))}else n.setAttribute(i,a);for(e=0;e<t.childNodes.length;e++)n.appendChild(c.createHtml(t.childNodes[e]))}catch(t){n=c.xmlTextNode("")}else for(n=c.xmlGenerator().createDocumentFragment(),e=0;e<t.childNodes.length;e++)n.appendChild(c.createHtml(t.childNodes[e]));else if(t.nodeType===c.ElementType.FRAGMENT)for(n=c.xmlGenerator().createDocumentFragment(),e=0;e<t.childNodes.length;e++)n.appendChild(c.createHtml(t.childNodes[e]));else t.nodeType===c.ElementType.TEXT&&(n=c.xmlTextNode(t.nodeValue));return n},escapeNode:function(t){return"string"!=typeof t?t:t.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(t){return"string"!=typeof t?t:t.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(t){return t.indexOf("@")<0?null:t.split("@")[0]},getDomainFromJid:function(t){var e=c.getBareJidFromJid(t);if(e.indexOf("@")<0)return e;var n=e.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(t){var e=t.split("/");return e.length<2?null:(e.splice(0,1),e.join("/"))},getBareJidFromJid:function(t){return t?t.split("/")[0]:null},_handleError:function(t){void 0!==t.stack&&c.fatal(t.stack),t.sourceURL?c.fatal("error: "+this.handler+" "+t.sourceURL+":"+t.line+" - "+t.name+": "+t.message):t.fileName?c.fatal("error: "+this.handler+" "+t.fileName+":"+t.lineNumber+" - "+t.name+": "+t.message):c.fatal("error: "+t.message)},log:function(t,e){},debug:function(t){this.log(this.LogLevel.DEBUG,t)},info:function(t){this.log(this.LogLevel.INFO,t)},warn:function(t){this.log(this.LogLevel.WARN,t)},error:function(t){this.log(this.LogLevel.ERROR,t)},fatal:function(t){this.log(this.LogLevel.FATAL,t)},serialize:function(t){var e;if(!t)return null;"function"==typeof t.tree&&(t=t.tree());var n,o,r=t.nodeName;for(t.getAttribute("_realname")&&(r=t.getAttribute("_realname")),e="<"+r,n=0;n<t.attributes.length;n++)"_realname"!==t.attributes[n].nodeName&&(e+=" "+t.attributes[n].nodeName+"='"+c.xmlescape(t.attributes[n].value)+"'");if(t.childNodes.length>0){for(e+=">",n=0;n<t.childNodes.length;n++)switch(o=t.childNodes[n],o.nodeType){case c.ElementType.NORMAL:e+=c.serialize(o);break;case c.ElementType.TEXT:e+=c.xmlescape(o.nodeValue);break;case c.ElementType.CDATA:e+="<![CDATA["+o.nodeValue+"]]>"}e+="</"+r+">"}else e+="/>";return e},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(t,e){c._connectionPlugins[t]=e}},c.Builder=function(t,e){"presence"!==t&&"message"!==t&&"iq"!==t||(e&&!e.xmlns?e.xmlns=c.NS.CLIENT:e||(e={xmlns:c.NS.CLIENT})),this.nodeTree=c.xmlElement(t,e),this.node=this.nodeTree},c.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return c.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(t){for(var e in t)t.hasOwnProperty(e)&&(void 0===t[e]?this.node.removeAttribute(e):this.node.setAttribute(e,t[e]));return this},c:function(t,e,n){var o=c.xmlElement(t,e,n);return this.node.appendChild(o),"string"!=typeof n&&"number"!=typeof n&&(this.node=o),this},cnode:function(t){var e,n=c.xmlGenerator();try{e=void 0!==n.importNode}catch(t){e=!1}var o=e?n.importNode(t,!0):c.copyElement(t);return this.node.appendChild(o),this.node=o,this},t:function(t){var e=c.xmlTextNode(t);return this.node.appendChild(e),this},h:function(t){var e=document.createElement("body");e.innerHTML=t;for(var n=c.createHtml(e);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},c.Handler=function(t,e,n,o,r,i,s){this.handler=t,this.ns=e,this.name=n,this.type=o,this.id=r,this.options=s||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(c.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=i?c.getBareJidFromJid(i):null:this.from=i,this.user=!0},c.Handler.prototype={getNamespace:function(t){var e=t.getAttribute("xmlns");return e&&this.options.ignoreNamespaceFragment&&(e=e.split("#")[0]),e},namespaceMatch:function(t){var e=!1;if(!this.ns)return!0;var n=this;return c.forEachChild(t,null,function(t){n.getNamespace(t)===n.ns&&(e=!0)}),e=e||this.getNamespace(t)===this.ns},isMatch:function(t){var e=t.getAttribute("from");this.options.matchBareFromJid&&(e=c.getBareJidFromJid(e));var n=t.getAttribute("type");return!(!this.namespaceMatch(t)||this.name&&!c.isTagEqual(t,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&t.getAttribute("id")!==this.id||this.from&&e!==this.from)},run:function(t){var e=null;try{e=this.handler(t)}catch(t){throw c._handleError(t),t}return e},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},c.TimedHandler=function(t,e){this.period=t,this.handler=e,this.lastCalled=(new Date).getTime(),this.user=!0},c.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},c.Connection=function(t,e){this.service=t,this.options=e||{};var o=this.options.protocol||"";0===t.indexOf("ws:")||0===t.indexOf("wss:")||0===o.indexOf("ws")?this._proto=new c.Websocket(this):this._proto=new c.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100),n.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms);for(var r in c._connectionPlugins)if(c._connectionPlugins.hasOwnProperty(r)){var i=c._connectionPlugins[r],s=function(){};s.prototype=i,this[r]=new s,this[r].init(this)}},c.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(t){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)});return"string"==typeof t||"number"==typeof t?e+":"+t:e+""},addProtocolErrorHandler:function(t,e,n){this.protocolErrorHandlers[t][e]=n},connect:function(t,e,n,o,r,i,s){this.jid=t,this.authzid=c.getBareJidFromJid(this.jid),this.authcid=s||c.getNodeFromJid(this.jid),this.pass=e,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=c.getDomainFromJid(this.jid),this._changeConnectStatus(c.Status.CONNECTING,null),this._proto._connect(o,r,i)},attach:function(t,e,n,o,r,i,s){if(!(this._proto instanceof c.Bosh))throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};this._proto._attach(t,e,n,o,r,i,s)},restore:function(t,e,n,o,r){if(!this._sessionCachingSupported())throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};this._proto._restore(t,e,n,o,r)},_sessionCachingSupported:function(){if(this._proto instanceof c.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(t){return!1}return!0}return!1},xmlInput:function(t){},xmlOutput:function(t){},rawInput:function(t){},rawOutput:function(t){},nextValidRid:function(t){},send:function(t){if(null!==t){if("function"==typeof t.sort)for(var e=0;e<t.length;e++)this._queueData(t[e]);else"function"==typeof t.tree?this._queueData(t.tree()):this._queueData(t);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(t,e,n,o){var r=null,i=this;"function"==typeof t.tree&&(t=t.tree());var s=t.getAttribute("id");if(s||(s=this.getUniqueId("sendPresence"),t.setAttribute("id",s)),"function"==typeof e||"function"==typeof n){var a=this.addHandler(function(t){r&&i.deleteTimedHandler(r),"error"===t.getAttribute("type")?n&&n(t):e&&e(t)},null,"presence",null,s);o&&(r=this.addTimedHandler(o,function(){return i.deleteHandler(a),n&&n(null),!1}))}return this.send(t),s},sendIQ:function(t,e,n,o){var r=null,i=this;"function"==typeof t.tree&&(t=t.tree());var s=t.getAttribute("id");if(s||(s=this.getUniqueId("sendIQ"),t.setAttribute("id",s)),"function"==typeof e||"function"==typeof n){var a=this.addHandler(function(t){r&&i.deleteTimedHandler(r);var o=t.getAttribute("type");if("result"===o)e&&e(t);else{if("error"!==o)throw{name:"StropheError",message:"Got bad IQ type of "+o};n&&n(t)}},null,"iq",["error","result"],s);o&&(r=this.addTimedHandler(o,function(){return i.deleteHandler(a),n&&n(null),!1}))}return this.send(t),s},_queueData:function(t){if(null===t||!t.tagName||!t.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(t)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(t,e){var n=new c.TimedHandler(t,e);return this.addTimeds.push(n),n},deleteTimedHandler:function(t){this.removeTimeds.push(t)},addHandler:function(t,e,n,o,r,i,s){var a=new c.Handler(t,e,n,o,r,i,s);return this.addHandlers.push(a),a},deleteHandler:function(t){this.removeHandlers.push(t);var e=this.addHandlers.indexOf(t);e>=0&&this.addHandlers.splice(e,1)},registerSASLMechanisms:function(t){this.mechanisms={},t=t||[c.SASLAnonymous,c.SASLExternal,c.SASLMD5,c.SASLOAuthBearer,c.SASLPlain,c.SASLSHA1],t.forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(t){this.mechanisms[t.prototype.name]=t},disconnect:function(t){if(this._changeConnectStatus(c.Status.DISCONNECTING,t),c.info("Disconnect was called because: "+t),this.connected){var e=!1;this.disconnecting=!0,this.authenticated&&(e=a({xmlns:c.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else c.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(t,e){for(var n in c._connectionPlugins)if(c._connectionPlugins.hasOwnProperty(n)){var o=this[n];if(o.statusChanged)try{o.statusChanged(t,e)}catch(t){c.error(n+" plugin caused an exception changing status: "+t)}}if(this.connect_callback)try{this.connect_callback(t,e)}catch(t){c._handleError(t),c.error("User connection callback caused an exception: "+t)}},_doDisconnect:function(t){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),c.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(c.Status.DISCONNECTED,t),this.connected=!1},_dataRecv:function(t,e){c.info("_dataRecv called");var n=this._proto._reqToData(t);if(null!==n){this.xmlInput!==c.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==c.Connection.prototype.rawInput&&(e?this.rawInput(e):this.rawInput(c.serialize(n)));for(var o,r;this.removeHandlers.length>0;)r=this.removeHandlers.pop(),(o=this.handlers.indexOf(r))>=0&&this.handlers.splice(o,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var i,s,a=n.getAttribute("type");if(null!==a&&"terminate"===a){if(this.disconnecting)return;return i=n.getAttribute("condition"),s=n.getElementsByTagName("conflict"),null!==i?("remote-stream-error"===i&&s.length>0&&(i="conflict"),this._changeConnectStatus(c.Status.CONNFAIL,i)):this._changeConnectStatus(c.Status.CONNFAIL,"unknown"),void this._doDisconnect(i)}var u=this;c.forEachChild(n,null,function(t){var e,n;for(n=u.handlers,u.handlers=[],e=0;e<n.length;e++){var o=n[e];try{!o.isMatch(t)||!u.authenticated&&o.user?u.handlers.push(o):o.run(t)&&u.handlers.push(o)}catch(t){c.warn("Removing Strophe handlers due to uncaught exception: "+t.message)}}})}},mechanisms:{},_connect_cb:function(t,e,n){c.info("_connect_cb was called"),this.connected=!0;var o;try{o=this._proto._reqToData(t)}catch(t){if("badformat"!==t)throw t;this._changeConnectStatus(c.Status.CONNFAIL,"bad-format"),this._doDisconnect("bad-format")}if(o){this.xmlInput!==c.Connection.prototype.xmlInput&&(o.nodeName===this._proto.strip&&o.childNodes.length?this.xmlInput(o.childNodes[0]):this.xmlInput(o)),this.rawInput!==c.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(c.serialize(o)));if(this._proto._connect_cb(o)!==c.Status.CONNFAIL){if(!(o.getElementsByTagNameNS?o.getElementsByTagNameNS(c.NS.STREAM,"features").length>0:o.getElementsByTagName("stream:features").length>0||o.getElementsByTagName("features").length>0))return void this._proto._no_auth_received(e);var r,i,s=[],a=o.getElementsByTagName("mechanism");if(a.length>0)for(r=0;r<a.length;r++)i=c.getText(a[r]),this.mechanisms[i]&&s.push(this.mechanisms[i]);if(0===s.length&&0===o.getElementsByTagName("auth").length)return void this._proto._no_auth_received(e);!1!==this.do_authentication&&this.authenticate(s)}}},sortMechanismsByPriority:function(t){var e,n,o,r;for(e=0;e<t.length-1;++e){for(o=e,n=e+1;n<t.length;++n)t[n].prototype.priority>t[o].prototype.priority&&(o=n);o!==e&&(r=t[e],t[e]=t[o],t[o]=r)}return t},_attemptSASLAuth:function(t){t=this.sortMechanismsByPriority(t||[]);var e=0,n=!1;for(e=0;e<t.length;++e)if(t[e].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new t[e],this._sasl_mechanism.onStart(this);var r=o("auth",{xmlns:c.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var i=this._sasl_mechanism.onChallenge(this,null);r.t(btoa(i))}this.send(r.tree()),n=!0;break}return n},_attemptLegacyAuth:function(){null===c.getNodeFromJid(this.jid)?(this._changeConnectStatus(c.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(c.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(i({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:c.NS.AUTH}).c("username",{}).t(c.getNodeFromJid(this.jid)).tree()))},authenticate:function(t){this._attemptSASLAuth(t)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(t){var e=atob(c.getText(t)),n=this._sasl_mechanism.onChallenge(this,e),r=o("response",{xmlns:c.NS.SASL});return""!==n&&r.t(btoa(n)),this.send(r.tree()),!0},_auth1_cb:function(t){var e=i({type:"set",id:"_auth_2"}).c("query",{xmlns:c.NS.AUTH}).c("username",{}).t(c.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return c.getResourceFromJid(this.jid)||(this.jid=c.getBareJidFromJid(this.jid)+"/strophe"),e.up().c("resource",{}).t(c.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(e.tree()),!1},_sasl_success_cb:function(t){if(this._sasl_data["server-signature"]){var e,n=atob(c.getText(t)),o=/([a-z]+)=([^,]+)(,|$)/,r=n.match(o);if("v"===r[1]&&(e=r[2]),e!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}c.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var i=[],s=function(t,e){for(;t.length;)this.deleteHandler(t.pop());return this._sasl_auth1_cb.bind(this)(e),!1};return i.push(this._addSysHandler(function(t){s.bind(this)(i,t)}.bind(this),null,"stream:features",null,null)),i.push(this._addSysHandler(function(t){s.bind(this)(i,t)}.bind(this),c.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(t){this.features=t;var e,n;for(e=0;e<t.childNodes.length;e++)n=t.childNodes[e],"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(c.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var o=c.getResourceFromJid(this.jid);return o?this.send(i({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:c.NS.BIND}).c("resource",{}).t(o).tree()):this.send(i({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:c.NS.BIND}).tree()),!1},_sasl_bind_cb:function(t){if("error"===t.getAttribute("type")){c.info("SASL binding failed.");var e,n=t.getElementsByTagName("conflict");return n.length>0&&(e="conflict"),this._changeConnectStatus(c.Status.AUTHFAIL,e),!1}var o,r=t.getElementsByTagName("bind");if(!(r.length>0))return c.info("SASL binding failed."),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1;o=r[0].getElementsByTagName("jid"),o.length>0&&(this.jid=c.getText(o[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(i({type:"set",id:"_session_auth_2"}).c("session",{xmlns:c.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null)))},_sasl_session_cb:function(t){if("result"===t.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null);else if("error"===t.getAttribute("type"))return c.info("Session creation failed."),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(t){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1},_auth2_cb:function(t){return"result"===t.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null)):"error"===t.getAttribute("type")&&(this._changeConnectStatus(c.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(t,e){var n=new c.TimedHandler(t,e);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(t,e,n,o,r){var i=new c.Handler(t,e,n,o,r);return i.user=!1,this.addHandlers.push(i),i},_onDisconnectTimeout:function(){return c.info("_onDisconnectTimeout was called"),this._changeConnectStatus(c.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var t,e,n,o;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)e=this.removeTimeds.pop(),(t=this.timedHandlers.indexOf(e))>=0&&this.timedHandlers.splice(t,1);var r=(new Date).getTime();for(o=[],t=0;t<this.timedHandlers.length;t++)e=this.timedHandlers[t],!this.authenticated&&e.user||(n=e.lastCalled+e.period,n-r<=0?e.run()&&o.push(e):o.push(e));this.timedHandlers=o,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100))}},c.SASLMechanism=function(t,e,n){this.name=t,this.isClientFirst=e,this.priority=n},c.SASLMechanism.prototype={test:function(t){return!0},onStart:function(t){this._connection=t},onChallenge:function(t,e){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},c.SASLAnonymous=function(){},c.SASLAnonymous.prototype=new c.SASLMechanism("ANONYMOUS",!1,20),c.SASLAnonymous.prototype.test=function(t){return null===t.authcid},c.SASLPlain=function(){},c.SASLPlain.prototype=new c.SASLMechanism("PLAIN",!0,30),c.SASLPlain.prototype.test=function(t){return null!==t.authcid},c.SASLPlain.prototype.onChallenge=function(t){var e=t.authzid;return e+="\0",e+=t.authcid,e+="\0",e+=t.pass,n.utf16to8(e)},c.SASLSHA1=function(){},c.SASLSHA1.prototype=new c.SASLMechanism("SCRAM-SHA-1",!0,50),c.SASLSHA1.prototype.test=function(t){return null!==t.authcid},c.SASLSHA1.prototype.onChallenge=function(o,r,i){var s=i||e.hexdigest(1234567890*Math.random()),a="n="+n.utf16to8(o.authcid);return a+=",r=",a+=s,o._sasl_data.cnonce=s,o._sasl_data["client-first-message-bare"]=a,a="n,,"+a,this.onChallenge=function(e,o){for(var r,i,s,a,c,u,l,p,h,d,f,m,y="c=biws,",_=e._sasl_data["client-first-message-bare"]+","+o+",",g=e._sasl_data.cnonce,v=/([a-z]+)=([^,]+)(,|$)/;o.match(v);){var b=o.match(v);switch(o=o.replace(b[0],""),b[1]){case"r":r=b[2];break;case"s":i=b[2];break;case"i":s=b[2]}}if(r.substr(0,g.length)!==g)return e._sasl_data={},e._sasl_failure_cb();for(y+="r="+r,_+=y,i=atob(i),i+="\0\0\0",h=n.utf16to8(e.pass),a=u=t.core_hmac_sha1(h,i),l=1;l<s;l++){for(c=t.core_hmac_sha1(h,t.binb2str(u)),p=0;p<5;p++)a[p]^=c[p];u=c}for(a=t.binb2str(a),d=t.core_hmac_sha1(a,"Client Key"),f=t.str_hmac_sha1(a,"Server Key"),m=t.core_hmac_sha1(t.str_sha1(t.binb2str(d)),_),e._sasl_data["server-signature"]=t.b64_hmac_sha1(f,_),p=0;p<5;p++)d[p]^=m[p];return y+=",p="+btoa(t.binb2str(d))}.bind(this),a},c.SASLMD5=function(){},c.SASLMD5.prototype=new c.SASLMechanism("DIGEST-MD5",!1,40),c.SASLMD5.prototype.test=function(t){return null!==t.authcid},c.SASLMD5.prototype._quote=function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},c.SASLMD5.prototype.onChallenge=function(t,o,r){for(var i,s=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,a=r||e.hexdigest(""+1234567890*Math.random()),c="",u=null,l="";o.match(s);)switch(i=o.match(s),o=o.replace(i[0],""),i[2]=i[2].replace(/^"(.+)"$/,"$1"),i[1]){case"realm":c=i[2];break;case"nonce":l=i[2];break;case"qop":i[2];break;case"host":u=i[2]}var p=t.servtype+"/"+t.domain;null!==u&&(p=p+"/"+u);var h=n.utf16to8(t.authcid+":"+c+":"+this._connection.pass),d=e.hash(h)+":"+l+":"+a,f="AUTHENTICATE:"+p,m="";return m+="charset=utf-8,",m+="username="+this._quote(n.utf16to8(t.authcid))+",",m+="realm="+this._quote(c)+",",m+="nonce="+this._quote(l)+",",m+="nc=00000001,",m+="cnonce="+this._quote(a)+",",m+="digest-uri="+this._quote(p)+",",m+="response="+e.hexdigest(e.hexdigest(d)+":"+l+":00000001:"+a+":auth:"+e.hexdigest(f))+",",m+="qop=auth",this.onChallenge=function(){return""},m},c.SASLOAuthBearer=function(){},c.SASLOAuthBearer.prototype=new c.SASLMechanism("OAUTHBEARER",!0,60),c.SASLOAuthBearer.prototype.test=function(t){return null!==t.pass},c.SASLOAuthBearer.prototype.onChallenge=function(t){var e="n,";return null!==t.authcid&&(e=e+"a="+t.authzid),e+=",",e+="",e+="auth=Bearer ",e+=t.pass,e+="",e+="",n.utf16to8(e)},c.SASLExternal=function(){},c.SASLExternal.prototype=new c.SASLMechanism("EXTERNAL",!0,10),c.SASLExternal.prototype.onChallenge=function(t){return t.authcid===t.authzid?"":t.authzid},{Strophe:c,$build:o,$iq:i,$msg:r,$pres:a,SHA1:t,MD5:e,b64_hmac_sha1:t.b64_hmac_sha1,b64_sha1:t.b64_sha1,str_hmac_sha1:t.str_hmac_sha1,str_sha1:t.str_sha1}}),function(t,e){if("function"!=typeof n||!n.amd)return e(Strophe,$build);n("strophe-bosh",["strophe-core"],function(t){return e(t.Strophe,t.$build)})}(0,function(t,e){return t.Request=function(e,n,o,r){this.id=++t._requestId,this.xmlData=e,this.data=t.serialize(e),this.origFunc=n,this.func=n,this.rid=o,this.date=NaN,this.sends=r||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},t.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"===e.tagName)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),t.error("responseXML: "+t.serialize(this.xhr.responseXML)),"parsererror"}else if(this.xhr.responseText)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),"badformat";return e},_newXHR:function(){var t=null;return window.XMLHttpRequest?(t=new XMLHttpRequest,t.overrideMimeType&&t.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),t.onreadystatechange=this.func.bind(null,this),t}},t.Bosh=function(t){this._conn=t,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this._requests=[]},t.Bosh.prototype={strip:null,_buildBody:function(){var n=e("body",{rid:this.rid++,xmlns:t.NS.HTTPBIND});return null!==this.sid&&n.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),n},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,n,o){this.wait=e||this.wait,this.hold=n||this.hold,this.errors=0;var r=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":t.NS.BOSH});o&&r.attrs({route:o});var i=this._conn._connect_cb;this._requests.push(new t.Request(r.tree(),this._onRequestStateChange.bind(this,i.bind(this._conn)),r.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,n,o,r,i,s,a){this._conn.jid=e,this.sid=n,this.rid=o,this._conn.connect_callback=r,this._conn.domain=t.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=i||this.wait,this.hold=s||this.hold,this.window=a||this.window,this._conn._changeConnectStatus(t.Status.ATTACHED,null)},_restore:function(e,n,o,r,i){var s=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(void 0!==s&&null!==s&&s.rid&&s.sid&&s.jid&&(void 0===e||null===e||t.getBareJidFromJid(s.jid)===t.getBareJidFromJid(e)||null===t.getNodeFromJid(e)&&t.getDomainFromJid(s.jid)===e)))throw{name:"StropheSessionError",message:"_restore: no restoreable session."};this._conn.restored=!0,this._attach(s.jid,s.sid,s.rid,n,o,r,i)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var n,o,r=e.getAttribute("type");if(null!==r&&"terminate"===r)return n=e.getAttribute("condition"),t.error("BOSH-Connection failed: "+n),o=e.getElementsByTagName("conflict"),null!==n?("remote-stream-error"===n&&o.length>0&&(n="conflict"),this._conn._changeConnectStatus(t.Status.CONNFAIL,n)):this._conn._changeConnectStatus(t.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),t.Status.CONNFAIL;this.sid||(this.sid=e.getAttribute("sid"));var i=e.getAttribute("requests");i&&(this.window=parseInt(i,10));var s=e.getAttribute("hold");s&&(this.hold=parseInt(s,10));var a=e.getAttribute("wait");a&&(this.wait=parseInt(a,10));var c=e.getAttribute("inactivity");c&&(this.inactivity=parseInt(c,10))},_disconnect:function(t){this._sendTerminate(t)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(t){var e,n=this._getRequestStatus(t);(e=this._conn.protocolErrorHandlers.HTTP[n])&&e.call(this,n)},_hitError:function(e){this.errors++,t.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var n=this._buildBody();this._requests.push(new t.Request(n.tree(),this._onRequestStateChange.bind(this,e.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var t;this._requests.length>0;)t=this._requests.pop(),t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(t.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var n=this._buildBody(),o=0;o<e.length;o++)null!==e[o]&&("restart"===e[o]?n.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":t.NS.BOSH}):n.cnode(e[o]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new t.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var r=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(t.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),r>Math.floor(t.TIMEOUT*this.wait)&&(t.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(t.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,n){var o;if(4===e.xhr.readyState)try{o=e.xhr.status}catch(e){t.error("Caught an error while retrieving a request's status, reqStatus: "+o)}return void 0===o&&(o="number"==typeof n?n:0),o},_onRequestStateChange:function(e,n){if(t.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)return void(n.abort=!1);if(4===n.xhr.readyState){var o=this._getRequestStatus(n);if(this.disconnecting&&o>=400)return this._hitError(o),void this._callProtocolErrorHandlers(n);var r=o>0&&o<500,i=n.sends>this._conn.maxRetries;if((r||i)&&(this._removeRequest(n),t.debug("request id "+n.id+" should now be removed")),200===o){var s=this._requests[0]===n;(this._requests[1]===n||s&&this._requests.length>0&&this._requests[0].age()>Math.floor(t.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),t.debug("request id "+n.id+"."+n.sends+" got 200"),e(n),this.errors=0}else 0===o||o>=400&&o<600||o>=12e3?(t.error("request id "+n.id+"."+n.sends+" error "+o+" happened"),this._hitError(o),this._callProtocolErrorHandlers(n),o>=400&&o<500&&(this._conn._changeConnectStatus(t.Status.DISCONNECTING,null),this._conn._doDisconnect())):t.error("request id "+n.id+"."+n.sends+" error "+o+" happened");r||i?i&&!this._conn.connected&&this._conn._changeConnectStatus(t.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(e){var n=this,o=this._requests[e],r=this._getRequestStatus(o,-1);if(o.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();var i=o.age(),s=!isNaN(i)&&i>Math.floor(t.TIMEOUT*this.wait),a=null!==o.dead&&o.timeDead()>Math.floor(t.SECONDARY_TIMEOUT*this.wait),c=4===o.xhr.readyState&&(r<1||r>=500);if((s||a||c)&&(a&&t.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),o.abort=!0,o.xhr.abort(),o.xhr.onreadystatechange=function(){},this._requests[e]=new t.Request(o.xmlData,o.origFunc,o.rid,o.sends),o=this._requests[e]),0===o.xhr.readyState){t.debug("request id "+o.id+"."+o.sends+" posting");try{var u=this._conn.options.contentType||"text/xml; charset=utf-8";o.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==o.xhr.setRequestHeader&&o.xhr.setRequestHeader("Content-Type",u),this._conn.options.withCredentials&&(o.xhr.withCredentials=!0)}catch(e){return t.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(t.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var l=function(){if(o.date=new Date,n._conn.options.customHeaders){var t=n._conn.options.customHeaders;for(var e in t)t.hasOwnProperty(e)&&o.xhr.setRequestHeader(e,t[e])}o.xhr.send(o.data)};if(o.sends>1){var p=1e3*Math.min(Math.floor(t.TIMEOUT*this.wait),Math.pow(o.sends,3));setTimeout(function(){l()},p)}else l();o.sends++,this._conn.xmlOutput!==t.Connection.prototype.xmlOutput&&(o.xmlData.nodeName===this.strip&&o.xmlData.childNodes.length?this._conn.xmlOutput(o.xmlData.childNodes[0]):this._conn.xmlOutput(o.xmlData)),this._conn.rawOutput!==t.Connection.prototype.rawOutput&&this._conn.rawOutput(o.data)}else t.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+o.xhr.readyState)},_removeRequest:function(e){t.debug("removing request");var n;for(n=this._requests.length-1;n>=0;n--)e===this._requests[n]&&this._requests.splice(n,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(t){var e=this._requests[t];null===e.dead&&(e.dead=new Date),this._processRequest(t)},_reqToData:function(t){try{return t.getResponse()}catch(t){if("parsererror"!==t)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){t.info("_sendTerminate was called");var n=this._buildBody().attrs({type:"terminate"});e&&n.cnode(e.tree());var o=new t.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"));this._requests.push(o),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?t.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):t.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},t}),function(t,e){if("function"!=typeof n||!n.amd)return e(Strophe,$build);n("strophe-websocket",["strophe-core"],function(t){return e(t.Strophe,t.$build)})}(0,function(t,e){return t.Websocket=function(t){this._conn=t,this.strip="wrapper";var e=t.service;if(0!==e.indexOf("ws:")&&0!==e.indexOf("wss:")){var n="";"ws"===t.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==e.indexOf("/")?n+=window.location.pathname+e:n+=e,t.service=n}},t.Websocket.prototype={_buildStream:function(){return e("open",{xmlns:t.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,n){var o;if(o=e.getElementsByTagNameNS?e.getElementsByTagNameNS(t.NS.STREAM,"error"):e.getElementsByTagName("stream:error"),0===o.length)return!1;for(var r=o[0],i="",s="",a=0;a<r.childNodes.length;a++){var c=r.childNodes[a];if("urn:ietf:params:xml:ns:xmpp-streams"!==c.getAttribute("xmlns"))break;"text"===c.nodeName?s=c.textContent:i=c.nodeName}var u="WebSocket stream error: ";return u+=i||"unknown",s&&(u+=" - "+s),t.error(u),this._conn._changeConnectStatus(n,i),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){if(this._check_streamerror(e,t.Status.CONNFAIL))return t.Status.CONNFAIL},_handleStreamStart:function(e){var n=!1,o=e.getAttribute("xmlns");"string"!=typeof o?n="Missing xmlns in <open />":o!==t.NS.FRAMING&&(n="Wrong xmlns in <open />: "+o);var r=e.getAttribute("version");return"string"!=typeof r?n="Missing version in <open />":"1.0"!==r&&(n="Wrong version in <open />: "+r),!n||(this._conn._changeConnectStatus(t.Status.CONNFAIL,n),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var n=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===n)return;var o=(new DOMParser).parseFromString(n,"text/xml").documentElement;this._conn.xmlInput(o),this._conn.rawInput(e.data),this._handleStreamStart(o)&&this._connect_cb(o)}else if(0===e.data.indexOf("<close ")){this._conn.rawInput(e.data),this._conn.xmlInput(e);var r=e.getAttribute("see-other-uri");r?(this._conn._changeConnectStatus(t.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=r,this._connect()):(this._conn._changeConnectStatus(t.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())}else{var i=this._streamWrap(e.data),s=(new DOMParser).parseFromString(i,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(s,null,e.data)}},_disconnect:function(n){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){n&&this._conn.send(n);var o=e("close",{xmlns:t.NS.FRAMING});this._conn.xmlOutput(o);var r=t.serialize(o);this._conn.rawOutput(r);try{this.socket.send(r)}catch(e){t.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){t.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(t){return"<wrapper>"+t+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(t){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(e){this._conn.connected&&!this._conn.disconnecting?(t.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(t.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(t.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):t.info("Websocket closed")},_no_auth_received:function(e){t.error("Server did not send any auth methods"),this._conn._changeConnectStatus(t.Status.CONNFAIL,"Server did not send any auth methods"),e&&(e=e.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){t.error("Websocket error "+e),this._conn._changeConnectStatus(t.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var n=0;n<e.length;n++)if(null!==e[n]){var o,r;o="restart"===e[n]?this._buildStream().tree():e[n],r=t.serialize(o),this._conn.xmlOutput(o),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}},_onMessage:function(e){var n,o,r='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===r)return this._conn.rawInput(r),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(n=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(n))return}else o=this._streamWrap(e.data),n=(new DOMParser).parseFromString(o,"text/xml").documentElement;return this._check_streamerror(n,t.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===n.firstChild.nodeName&&"unavailable"===n.firstChild.getAttribute("type")?(this._conn.xmlInput(n),void this._conn.rawInput(t.serialize(n))):void this._conn._dataRecv(n,e.data)},_onOpen:function(){t.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var n=t.serialize(e);this._conn.rawOutput(n),this.socket.send(n)},_reqToData:function(t){return t},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},t}),function(t){"function"==typeof n&&n.amd&&n("strophe",["strophe-core","strophe-bosh","strophe-websocket"],function(t){return t})}(),e(["strophe-polyfill"]),e("strophe")})}]);